(self.webpackChunkdoc_sign_client=self.webpackChunkdoc_sign_client||[]).push([[645],{1815:()=>{},2787:()=>{},3237:()=>{},4122:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var n=r(5043),a=r(3546),i=r(7200),s=r(7021),l=r(579);const o=[{label:"Handwritten",value:"Pacifico, cursive"},{label:"Serif",value:"Georgia, serif"},{label:"Sans",value:"Arial, sans-serif"},{label:"Script",value:"Dancing Script, cursive"},{label:"Monospace",value:"Courier New, monospace"}],c={hidden:{opacity:0,scale:.96,y:24},visible:{opacity:1,scale:1,y:0,transition:{duration:.22,ease:"easeOut"}},exit:{opacity:0,scale:.96,y:-24,transition:{duration:.18,ease:"easeIn"}}},d=e=>{let{open:t,onClose:r,onSave:d}=e;const[u,g]=(0,n.useState)("draw"),[p,m]=(0,n.useState)(""),[x,h]=(0,n.useState)(o[0].value),[f,y]=(0,n.useState)(null),b=(0,n.useRef)(),v=(0,n.useRef)(),w=(0,n.useRef)(),j=(0,n.useRef)(),[N,P]=(0,n.useState)(""),[S,k]=(0,n.useState)(null),[E,R]=(0,n.useState)(!0);if((0,n.useEffect)(()=>{if(t){if("draw"===u&&b.current){v.current&&(v.current.off(),v.current=null),v.current=new s.A(b.current,{backgroundColor:"rgb(255,255,255)",penColor:"rgb(0,0,0)",minWidth:1.5,maxWidth:2.5,throttle:16,onEnd:()=>{C()}});const e=()=>{C()};return b.current.addEventListener("pointerup",e),b.current.addEventListener("touchend",e),R(!0),k(null),()=>{b.current&&(b.current.removeEventListener("pointerup",e),b.current.removeEventListener("touchend",e))}}setTimeout(()=>{"draw"===u&&b.current&&b.current.focus(),"type"===u&&j.current&&j.current.focus()},0)}},[t,u]),(0,n.useEffect)(()=>{if(!t)return;const e=e=>{if("Escape"===e.key&&r(),"Tab"===e.key&&w.current){const t=w.current.querySelectorAll('input, button, canvas, [tabindex]:not([tabindex="-1"])'),r=t[0],n=t[t.length-1];(e.shiftKey?document.activeElement===r:document.activeElement===n)&&(e.preventDefault(),(e.shiftKey?n:r).focus())}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[t,r]),(0,n.useEffect)(()=>()=>{v.current&&(v.current.off(),v.current=null)},[]),!t)return null;const C=()=>{if(v.current){const e=v.current.isEmpty();R(e),k(e?null:v.current.toDataURL("image/png"))}};return(0,l.jsx)(a.N,{children:t&&(0,l.jsx)(i.P.div,{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",role:"dialog","aria-modal":"true","aria-labelledby":"signature-modal-title","aria-describedby":"signature-modal-desc",initial:"hidden",animate:"visible",exit:"exit",variants:c,children:(0,l.jsxs)(i.P.div,{ref:w,className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-md relative max-h-[90vh] overflow-y-auto",tabIndex:"-1",initial:{scale:.98,opacity:0,y:24},animate:{scale:1,opacity:1,y:0,transition:{duration:.22}},exit:{scale:.98,opacity:0,y:-24,transition:{duration:.18}},children:[(0,l.jsx)(i.P.button,{className:"absolute top-2 right-2 text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-400 rounded",onClick:r,"aria-label":"Close signature modal",whileHover:{scale:1.1},whileTap:{scale:.95},children:"\xd7"}),(0,l.jsx)("h2",{id:"signature-modal-title",className:"text-xl font-semibold mb-4",children:"Add Your Signature"}),(0,l.jsx)("div",{id:"signature-modal-desc",className:"sr-only",children:"Add your signature by drawing, typing, or uploading an image. Use the tabs to switch modes."}),(0,l.jsx)("div",{className:"flex space-x-2 mb-4",role:"tablist","aria-label":"Signature input modes",children:[{key:"draw",label:"Draw",icon:"\u270f\ufe0f"},{key:"type",label:"Type",icon:"\u2328\ufe0f"},{key:"upload",label:"Upload",icon:"\ud83d\udcc1"}].map(e=>(0,l.jsx)(i.P.button,{className:"flex-1 py-3 px-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-400 transition-colors min-w-[44px] min-h-[44px] ".concat(u===e.key?"bg-indigo-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"),onClick:()=>g(e.key),"aria-label":"".concat(e.label," signature"),"aria-selected":u===e.key,"aria-controls":"signature-tabpanel-".concat(e.key),role:"tab",tabIndex:0,title:e.label,whileHover:{scale:1.05},whileTap:{scale:.96},children:(0,l.jsxs)("div",{className:"flex items-center justify-center space-x-1",children:[(0,l.jsx)("span",{children:e.icon}),(0,l.jsx)("span",{className:"text-sm font-medium",children:e.label})]})},e.key))}),"draw"===u&&(0,l.jsxs)(i.P.div,{className:"flex flex-col items-center",id:"signature-tabpanel-draw",role:"tabpanel","aria-labelledby":"signature-tab-draw",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.2},children:[(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("canvas",{ref:b,width:400,height:100,className:"border-2 border-gray-300 rounded-lg mb-3 cursor-crosshair bg-white focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:border-indigo-400 min-h-[44px] min-w-[200px]",style:{touchAction:"none"},tabIndex:0,"aria-label":"Draw your signature here",title:"Draw your signature here"}),(0,l.jsx)("div",{className:"absolute top-2 right-2 text-xs text-gray-500 bg-white/80 px-2 py-1 rounded",children:"Draw here"})]}),(0,l.jsxs)("div",{className:"flex space-x-2 mb-2",children:[(0,l.jsx)(i.P.button,{className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 focus:outline-none focus:ring-2 focus:ring-indigo-400 rounded min-w-[44px] min-h-[44px]",onClick:()=>{if(v.current){const e=v.current.toData();e&&(e.pop(),v.current.fromData(e),C())}},"aria-label":"Undo last stroke",title:"Undo",whileHover:{scale:1.05},whileTap:{scale:.95},children:"Undo"}),(0,l.jsx)(i.P.button,{className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 focus:outline-none focus:ring-2 focus:ring-indigo-400 rounded min-w-[44px] min-h-[44px]",onClick:()=>{v.current&&(v.current.clear(),C())},"aria-label":"Clear signature",title:"Clear",whileHover:{scale:1.05},whileTap:{scale:.95},children:"Clear"})]}),(0,l.jsxs)("div",{className:"w-full flex flex-col items-center mt-2",children:[(0,l.jsx)("span",{className:"text-xs text-gray-500 mb-1",children:"Preview:"}),(0,l.jsx)("div",{className:"border rounded bg-gray-50 p-2 min-h-[60px] min-w-[200px] flex items-center justify-center",children:S?(0,l.jsx)("img",{src:S,alt:"Signature preview",className:"max-h-16 max-w-full"}):(0,l.jsx)("span",{className:"text-gray-400",children:"(Draw above to preview)"})})]})]}),"type"===u&&(0,l.jsxs)(i.P.div,{className:"flex flex-col items-center space-y-3",id:"signature-tabpanel-type",role:"tabpanel","aria-labelledby":"signature-tab-type",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.2},children:[(0,l.jsx)("label",{htmlFor:"signature-type-name",className:"sr-only",children:"Type your name"}),(0,l.jsx)("input",{ref:j,id:"signature-type-name",name:"typedName",type:"text",className:"w-full border-2 border-gray-300 rounded-lg px-4 py-3 text-center text-lg focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:border-indigo-400 min-h-[44px]",placeholder:"Type your name",value:p,onChange:e=>m(e.target.value),maxLength:32,"aria-label":"Type your name",title:"Type your name"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-2 justify-center",children:o.map(e=>(0,l.jsx)(i.P.button,{className:"px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-400 transition-colors min-w-[44px] min-h-[44px] ".concat(x===e.value?"bg-indigo-500 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"),style:{fontFamily:e.value},onClick:()=>h(e.value),"aria-label":"Select font: ".concat(e.label),title:e.label,whileHover:{scale:1.05},whileTap:{scale:.96},children:e.label},e.value))}),(0,l.jsx)("div",{className:"mt-4 p-4 border-2 border-gray-200 rounded-lg bg-gray-50 text-2xl min-h-[60px] flex items-center justify-center",style:{fontFamily:x,minWidth:300},children:p||"Your Name"})]}),"upload"===u&&(0,l.jsxs)(i.P.div,{className:"flex flex-col items-center",id:"signature-tabpanel-upload",role:"tabpanel","aria-labelledby":"signature-tab-upload",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.2},children:[(0,l.jsx)("div",{className:"w-full",children:(0,l.jsxs)("label",{className:"block w-full p-4 border-2 border-dashed border-gray-300 rounded-lg text-center cursor-pointer hover:border-indigo-400 hover:bg-indigo-50 transition-colors min-h-[44px]",title:"Click to upload signature",children:[(0,l.jsx)("input",{type:"file",accept:".png,.jpg,.jpeg,.svg",onChange:e=>{P("");const t=e.target.files[0];if(!t)return;if(!["image/png","image/jpeg","image/jpg","image/svg+xml"].includes(t.type))return void P("Only PNG, JPG, JPEG, or SVG files are allowed.");if(t.size>1048576)return void P("File size must be 1MB or less.");const r=new FileReader;r.onload=e=>y(e.target.result),r.readAsDataURL(t)},"aria-label":"Upload signature image",className:"hidden"}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("svg",{className:"w-8 h-8 mx-auto text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Click to upload signature"}),(0,l.jsx)("p",{className:"text-xs text-gray-500",children:"PNG, JPG, JPEG, SVG. Max 1MB."})]})]})]})}),N&&(0,l.jsx)(i.P.div,{className:"text-sm text-rose-500 mt-2 text-center",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:N}),f&&(0,l.jsxs)(i.P.div,{className:"mt-4 text-center",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},children:[(0,l.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"Preview:"}),(0,l.jsx)("img",{src:f,alt:"Signature preview",className:"max-h-24 mx-auto border rounded"})]})]}),(0,l.jsxs)("div",{className:"flex justify-end mt-6 space-x-3",children:[(0,l.jsx)(i.P.button,{className:"px-6 py-3 rounded-lg bg-gray-200 hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition-colors min-w-[44px] min-h-[44px]",onClick:r,"aria-label":"Cancel signature input",title:"Cancel",whileHover:{scale:1.05},whileTap:{scale:.96},children:"Cancel"}),(0,l.jsx)(i.P.button,{className:"px-6 py-3 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-indigo-400 transition-colors min-w-[44px] min-h-[44px]",onClick:()=>{if("draw"===u){if(v.current&&!v.current.isEmpty()){const e=v.current.toDataURL("image/png");d(e,"drawn")}}else if("type"===u){if(p.trim()){const e=document.createElement("canvas");e.width=400,e.height=100;const t=e.getContext("2d");t.fillStyle="#fff",t.fillRect(0,0,e.width,e.height),t.font="48px ".concat(x),t.fillStyle="#222",t.textBaseline="middle",t.textAlign="center",t.fillText(p,200,50),d(e.toDataURL("image/png"),"typed")}}else"upload"===u&&f&&d(f,"uploaded")},disabled:!("draw"===u?v.current&&!v.current.isEmpty():"type"===u?p.trim().length>0:"upload"===u&&f),"aria-label":"Save signature",title:"Save signature",whileHover:{scale:1.05},whileTap:{scale:.96},children:"Save Signature"})]})]})})})}},6671:()=>{},7492:()=>{},7640:()=>{},8072:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var n=r(5043),a=r(2809),i=r(6730),s=r(934),l=r(579);a.A.GlobalWorkerOptions.workerSrc="https://unpkg.com/pdfjs-dist@".concat("3.11.174","/build/pdf.worker.min.js");class o extends n.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,t){console.error("PDF Rendering Error:",e,t)}render(){return this.state.hasError?(0,l.jsx)("div",{className:"p-4 bg-red-50 border border-red-200 rounded",children:(0,l.jsx)("p",{className:"text-red-600",children:"Error loading PDF. Please try refreshing the page."})}):this.props.children}}function c(e,t){const r=new FileReader;r.onload=function(e){const r=new Uint8Array(e.target.result);t(Array.from(r).slice(0,20).map(e=>e.toString(16).padStart(2,"0")).join(" "))},r.readAsArrayBuffer(e)}const d=e=>{let{file:t,base64:r,onPageChange:d,initialPage:u=1,signatureFields:g=[],onPageClick:p,onUpdateField:m,onRemoveField:x}=e;const[h,f]=(0,n.useState)(null),[y,b]=(0,n.useState)(u),[v,w]=(0,n.useState)(null),[j,N]=(0,n.useState)(!0),[P,S]=(0,n.useState)({width:900,height:1200}),k=(0,n.useRef)(),E=(0,n.useRef)(null),R=(0,n.useRef)({x:0,y:0}),[C,L]=(0,n.useState)(null),[D,F]=(0,n.useState)(""),[U,A]=(0,n.useState)(null),[B,T]=(0,n.useState)(null);(0,n.useEffect)(()=>((async()=>{try{if(N(!0),w(null),"string"===typeof t&&t.startsWith("blob:")){console.log("Processing blob URL:",t);try{const e=await fetch(t);if(!e.ok)throw new Error("Failed to fetch blob: ".concat(e.status));const r=await e.blob();T(r);const n=URL.createObjectURL(r);L(n),A(n),console.log("Blob info:",{size:r.size,type:r.type,url:n}),c(r,F)}catch(e){console.error("Error processing blob URL:",e),w("Error loading PDF: ".concat(e.message))}}else if(t instanceof Blob){console.log("Processing Blob object:",t);const e=URL.createObjectURL(t);L(e),A(e),T(t),c(t,F)}else if(r){console.log("Processing base64 PDF");const e=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"application/pdf";const r=atob(e),n=new Array(r.length);for(let i=0;i<r.length;i++)n[i]=r.charCodeAt(i);const a=new Uint8Array(n);return new Blob([a],{type:t})}(r),t=URL.createObjectURL(e);L(t),A(t),T(e),c(e,F)}else console.log("No valid file provided, using fallback")}catch(e){console.error("Error in processFile:",e),w("Failed to process PDF: ".concat(e.message))}finally{N(!1)}})(),()=>{C&&(console.log("Cleaning up object URL:",C),URL.revokeObjectURL(C))}),[t,r]),(0,n.useEffect)(()=>{console.log("PDFRenderer - State update:",{file:t,objectUrl:C,pdfBlob:B,loading:j,error:v,"pdfjs.version":a.A.version})},[t,C,B,j,v]);const G=C||("string"===typeof t?t:"https://cdn.syncfusion.com/content/pdf/pdf-succinctly.pdf");(0,n.useEffect)(()=>{b(u)},[u]),(0,n.useEffect)(()=>{console.log("PDFRenderer - Current file:",t),console.log("PDFRenderer - Object URL:",C),console.log("PDFRenderer - PDF.js version:",a.A.version)},[t,C]);const z=e=>{if(!E.current||!m)return;const t=k.current.getBoundingClientRect(),r=e.clientX-t.left-R.current.x,n=e.clientY-t.top-R.current.y;m(E.current,{x:r,y:n})},H=()=>{E.current=null,window.removeEventListener("mousemove",z),window.removeEventListener("mouseup",H)};return(0,l.jsx)(o,{children:(0,l.jsx)("div",{className:"flex flex-col h-full w-full",children:(0,l.jsx)("div",{className:"flex-1 min-h-0 overflow-auto flex justify-center items-start bg-gray-50",children:(0,l.jsxs)("div",{className:"w-full max-w-5xl flex flex-col items-center relative m-auto",children:[t instanceof Blob&&(0,l.jsxs)("div",{className:"text-xs text-gray-500 mb-2",children:[(0,l.jsxs)("div",{children:["Blob size: ",t.size," bytes"]}),(0,l.jsxs)("div",{children:["Blob type: ",t.type]}),(0,l.jsxs)("div",{children:["First 20 bytes (hex): ",D]}),U&&(0,l.jsx)("a",{href:U,download:"debug.pdf",className:"ml-2 px-2 py-1 bg-blue-100 rounded",children:"Download Blob"})]}),j&&(0,l.jsxs)("div",{className:"flex items-center justify-center h-64",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mr-3"}),(0,l.jsx)("span",{children:"Loading PDF..."}),(0,l.jsx)("div",{className:"text-xs text-gray-400 mt-2",children:"string"===typeof G?G:"[Blob] PDF"})]}),v&&(0,l.jsxs)("div",{className:"text-red-500 p-4 border border-red-200 rounded text-center",children:[(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Error:"})," ",v]}),(0,l.jsxs)("div",{className:"text-xs text-gray-400 mt-2",children:["File: ",String(G)]}),U&&(0,l.jsx)("a",{href:U,download:"debug.pdf",className:"ml-2 px-2 py-1 bg-blue-100 rounded",children:"Download Blob"})]}),!v&&!j&&(0,l.jsxs)("div",{ref:k,className:"relative my-8",style:{width:P.width,height:P.height,cursor:p?"crosshair":"default"},onClick:e=>{if(!p)return;const t=k.current.getBoundingClientRect(),r=e.clientX-t.left,n=e.clientY-t.top;p(y,r,n,P)},children:[(0,l.jsx)(i.A,{file:G,onLoadSuccess:e=>{let{numPages:t}=e;console.log("[PDFRenderer] onLoadSuccess, numPages:",t),f(t),N(!1),w(null),d&&d(y)},onLoadError:e=>{console.error("[PDFRenderer] onLoadError:",e),w(e.message||"Failed to load PDF"),N(!1)},error:(0,l.jsx)("div",{className:"text-red-500",children:"Failed to load PDF."}),loading:null,children:(0,l.jsx)(s.A,{pageNumber:y,width:900,renderAnnotationLayer:!1,renderTextLayer:!1,onRenderSuccess:e=>{const t=e.getViewport({scale:1});S({width:t.width,height:t.height})}})}),g.filter(e=>e.page===y).map((e,t)=>(0,l.jsxs)("div",{className:"absolute border-2 border-indigo-500 bg-white bg-opacity-80 rounded shadow-md flex items-center justify-center cursor-move group",style:{left:e.x-(e.width||90)/2,top:e.y-(e.height||30)/2,width:e.width||180,height:e.height||60,zIndex:10,pointerEvents:"auto",userSelect:"none"},onMouseDown:t=>((e,t)=>{e.stopPropagation(),E.current=t.id;const r=k.current.getBoundingClientRect();R.current={x:e.clientX-(r.left+t.x),y:e.clientY-(r.top+t.y)},window.addEventListener("mousemove",z),window.addEventListener("mouseup",H)})(t,e),children:[(0,l.jsx)("span",{className:"text-indigo-700 font-bold select-none",children:"Sign"}),x&&(0,l.jsx)("button",{className:"absolute top-0 right-0 m-1 w-5 h-5 rounded-full bg-red-500 text-white text-xs flex items-center justify-center opacity-80 hover:opacity-100 group-hover:opacity-100",style:{zIndex:20},onClick:t=>{t.stopPropagation(),x(e.id)},"aria-label":"Remove signature field",children:"\xd7"})]},e.id||t))]})]})})})})}}}]);
//# sourceMappingURL=645.15bc25d8.chunk.js.map