{"ast":null,"code":"var _jsxFileName = \"D:\\\\Doc Sign\\\\client\\\\src\\\\pages\\\\DocumentViewerPage.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { useAuth, api } from '../context/AuthContext';\nimport PDFRenderer from '../components/PDFRenderer';\nimport Header from '../components/Header';\nimport SignatureInputModal from '../components/SignatureInputModal';\nimport { cssToPDF } from '../utils/coordinateTransform';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst DEFAULT_SIG_WIDTH = 180;\nconst DEFAULT_SIG_HEIGHT = 60;\n\n// TODO: Integrate signature overlay and placement logic\n\nconst DocumentViewerPage = () => {\n  _s();\n  const {\n    id\n  } = useParams();\n  const {\n    token,\n    user\n  } = useAuth();\n  const [pdfFile, setPdfFile] = useState(null); // Blob or URL\n  const [docInfo, setDocInfo] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [signatureFields, setSignatureFields] = useState([]);\n  const [showSignatureModal, setShowSignatureModal] = useState(false);\n  const [pendingSignature, setPendingSignature] = useState(null); // { dataUrl, type }\n  const [selectedFieldId, setSelectedFieldId] = useState(null);\n  const [pageDims, setPageDims] = useState({\n    width: 900,\n    height: 1200\n  });\n  const [currentPage, setCurrentPage] = useState(1);\n  const [sigActionLoading, setSigActionLoading] = useState(false);\n  const [sigActionError, setSigActionError] = useState('');\n  const [finalizeLoading, setFinalizeLoading] = useState(false);\n  const [finalizeError, setFinalizeError] = useState('');\n  const [pdfBlobUrl, setPdfBlobUrl] = useState(null);\n  const [pdfPageDims, setPdfPageDims] = useState({\n    width: 900,\n    height: 1200\n  }); // PDF points\n  const [showShareModal, setShowShareModal] = useState(false);\n  const [shareLink, setShareLink] = useState('');\n\n  // Fetch document metadata and signature overlays only.\n  useEffect(() => {\n    if (!id) return;\n    setLoading(true);\n    setError('');\n    setDocInfo(null);\n    setSignatureFields([]);\n    const fetchDoc = async () => {\n      try {\n        // Fetch document metadata\n        const docRes = await api.get(`/api/docs/${id}`);\n        setDocInfo(docRes.data.document);\n        // Map signers/signatureData to overlays\n        const signers = docRes.data.document.signers || [];\n        const overlays = signers.filter(s => s.signatureData && s.signatureData.image).map((s, idx) => ({\n          id: s._id || idx,\n          page: s.signatureData.page || 1,\n          x: s.signatureData.x || 50,\n          y: s.signatureData.y || 50,\n          width: s.signatureData.width || DEFAULT_SIG_WIDTH,\n          height: s.signatureData.height || DEFAULT_SIG_HEIGHT,\n          rotation: s.signatureData.rotation || 0,\n          signature: {\n            data: s.signatureData.image,\n            type: s.signatureData.type\n          },\n          signerEmail: s.email\n        }));\n        setSignatureFields(overlays);\n      } catch (err) {\n        var _err$response, _err$response$data;\n        setError(((_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.message) || 'Failed to load document.');\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchDoc();\n  }, [id, token]);\n  useEffect(() => {\n    const fetchPdfBlob = async () => {\n      if (!docInfo) return;\n      try {\n        setLoading(true);\n        setError('');\n        // Always get the latest JWT from localStorage\n        const latestToken = localStorage.getItem('token');\n        const res = await api.get(`/api/docs/${docInfo._id}/download`, {\n          responseType: 'blob',\n          headers: {\n            Authorization: `Bearer ${latestToken}`\n          }\n        });\n        const blobUrl = window.URL.createObjectURL(res.data);\n        setPdfBlobUrl(blobUrl);\n      } catch (err) {\n        var _err$response2, _err$response2$data;\n        setError(((_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : (_err$response2$data = _err$response2.data) === null || _err$response2$data === void 0 ? void 0 : _err$response2$data.message) || 'Failed to load PDF.');\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchPdfBlob();\n    // Clean up blob URL on unmount\n    return () => {\n      if (pdfBlobUrl) window.URL.revokeObjectURL(pdfBlobUrl);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [docInfo]);\n\n  // Handle click-to-place signature field (only if a signature is pending)\n  const handlePageClick = async (page, x, y, dims) => {\n    if (!pendingSignature || !docInfo) return;\n    setSigActionLoading(true);\n    setSigActionError('');\n    try {\n      // Calculate scale between rendered PDF and actual PDF points\n      const scale = dims.width / pdfPageDims.width;\n      // Debug logging\n      console.log('[Signature Placement Debug]');\n      console.log('Rendered PDF size (pixels):', dims.width, dims.height);\n      console.log('Actual PDF size (points):', pdfPageDims.width, pdfPageDims.height);\n      console.log('Click coordinates (pixels):', x, y);\n      console.log('Scale (rendered/actual):', scale);\n      // Convert to PDF coordinates using actual PDF page size and scale\n      const pdfCoords = cssToPDF(x, y, pdfPageDims.height, scale, DEFAULT_SIG_HEIGHT);\n      console.log('Calculated PDF coordinates (points):', pdfCoords.x, pdfCoords.y);\n      // Save to backend (self-sign)\n      await api.post('/api/signatures/self-sign', {\n        documentId: docInfo._id,\n        signerEmail: user.email,\n        signerName: user.firstName + ' ' + user.lastName,\n        signatureData: pendingSignature.data,\n        signatureType: pendingSignature.type,\n        position: {\n          page,\n          x: pdfCoords.x,\n          y: pdfCoords.y,\n          width: DEFAULT_SIG_WIDTH,\n          height: DEFAULT_SIG_HEIGHT,\n          rotation: 0,\n          image: pendingSignature.data,\n          type: pendingSignature.type\n        }\n      });\n      // Reload document and overlays\n      const docRes = await api.get(`/api/docs/${id}`);\n      setDocInfo(docRes.data.document);\n      const signers = docRes.data.document.signers || [];\n      const overlays = signers.filter(s => s.signatureData && s.signatureData.image).map((s, idx) => ({\n        id: s._id || idx,\n        page: s.signatureData.page || 1,\n        x: s.signatureData.x || 50,\n        y: s.signatureData.y || 50,\n        width: s.signatureData.width || DEFAULT_SIG_WIDTH,\n        height: s.signatureData.height || DEFAULT_SIG_HEIGHT,\n        rotation: s.signatureData.rotation || 0,\n        signature: {\n          data: s.signatureData.image,\n          type: s.signatureData.type\n        },\n        signerEmail: s.email\n      }));\n      setSignatureFields(overlays);\n      setPendingSignature(null);\n      setShowSignatureModal(false);\n    } catch (err) {\n      var _err$response3, _err$response4, _err$response5, _err$response5$data;\n      if (((_err$response3 = err.response) === null || _err$response3 === void 0 ? void 0 : _err$response3.status) === 401 || ((_err$response4 = err.response) === null || _err$response4 === void 0 ? void 0 : _err$response4.status) === 403) {\n        // Redirect to login if unauthorized\n        window.location.href = '/login?sessionExpired=true';\n        return;\n      }\n      setSigActionError(((_err$response5 = err.response) === null || _err$response5 === void 0 ? void 0 : (_err$response5$data = _err$response5.data) === null || _err$response5$data === void 0 ? void 0 : _err$response5$data.message) || 'Failed to save signature.');\n    } finally {\n      setSigActionLoading(false);\n    }\n  };\n\n  // Update a signature field's position/size/rotation (optional: sync with backend)\n  const handleUpdateField = (id, updates) => {\n    console.log('[handleUpdateField]', id, updates);\n    setSignatureFields(fields => fields.map(f => f.id === id ? {\n      ...f,\n      ...updates\n    } : f));\n    // Optionally, sync with backend here\n  };\n\n  // Remove a signature field (optional: sync with backend)\n  const handleRemoveField = id => {\n    setSignatureFields(fields => fields.filter(f => f.id !== id));\n    setSelectedFieldId(null);\n    // Optionally, sync with backend here\n  };\n\n  // Save signature modal result\n  const handleSignatureSave = (dataUrl, type) => {\n    setPendingSignature({\n      data: dataUrl,\n      type\n    });\n    setShowSignatureModal(false); // Close the modal after saving\n    // Modal closes, user will click to place on PDF\n  };\n\n  // Track selected field for coordinate display\n  const handleFieldSelect = id => {\n    setSelectedFieldId(id);\n  };\n\n  // Get selected field's coordinates (PDF system)\n  const selectedField = signatureFields.find(f => f.id === selectedFieldId);\n\n  // Finalize and download signed PDF\n  const handleFinalizeDownload = async () => {\n    if (!docInfo) return;\n    setFinalizeLoading(true);\n    setFinalizeError('');\n    try {\n      const res = await api.post(`/api/signatures/finalize/${docInfo._id}`, {}, {\n        responseType: 'blob'\n      });\n      // Download the PDF\n      const url = window.URL.createObjectURL(new Blob([res.data], {\n        type: 'application/pdf'\n      }));\n      const link = document.createElement('a');\n      link.href = url;\n      link.setAttribute('download', `${docInfo.originalName || 'signed-document'}.pdf`);\n      document.body.appendChild(link);\n      link.click();\n      link.parentNode.removeChild(link);\n      window.URL.revokeObjectURL(url);\n    } catch (err) {\n      var _err$response6, _err$response7, _err$response8, _err$response8$data;\n      if (((_err$response6 = err.response) === null || _err$response6 === void 0 ? void 0 : _err$response6.status) === 401 || ((_err$response7 = err.response) === null || _err$response7 === void 0 ? void 0 : _err$response7.status) === 403) {\n        window.location.href = '/login?sessionExpired=true';\n        return;\n      }\n      setFinalizeError(((_err$response8 = err.response) === null || _err$response8 === void 0 ? void 0 : (_err$response8$data = _err$response8.data) === null || _err$response8$data === void 0 ? void 0 : _err$response8$data.message) || 'Failed to finalize and download PDF.');\n    } finally {\n      setFinalizeLoading(false);\n    }\n  };\n\n  // Add share handler\n  const handleShare = () => {\n    // For demo: use current document's public link or download link\n    const link = `${window.location.origin}/document/${docInfo._id}`;\n    setShareLink(link);\n    setShowShareModal(true);\n  };\n  const handleCopyLink = () => {\n    navigator.clipboard.writeText(shareLink);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex flex-col h-screen min-h-0 w-full\",\n    children: [/*#__PURE__*/_jsxDEV(Header, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 240,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"h-12 flex items-center justify-center bg-gray-50 border-b border-gray-200 z-10\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"px-3 py-2 bg-gray-200 rounded disabled:opacity-50 font-semibold min-w-[44px] min-h-[36px] focus:outline-none focus:ring-2 focus:ring-indigo-400 mx-1\",\n        onClick: () => setCurrentPage(p => Math.max(1, p - 1)),\n        disabled: currentPage <= 1,\n        \"aria-label\": \"Previous page\",\n        title: \"Previous page\",\n        tabIndex: 0,\n        children: \"Previous\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"text-gray-700 font-medium mx-2\",\n        \"aria-live\": \"polite\",\n        children: [\"Page \", currentPage]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 253,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"px-3 py-2 bg-gray-200 rounded disabled:opacity-50 font-semibold min-w-[44px] min-h-[36px] focus:outline-none focus:ring-2 focus:ring-indigo-400 mx-1\",\n        onClick: () => setCurrentPage(p => p + 1),\n        disabled: false // We'll disable if we know numPages\n        ,\n        \"aria-label\": \"Next page\",\n        title: \"Next page\",\n        tabIndex: 0,\n        children: \"Next\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 256,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 242,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex-1 min-h-0 overflow-auto flex justify-center items-start bg-gray-50\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-full max-w-5xl flex flex-col items-center relative m-auto\",\n        children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n          className: \"text-2xl font-bold mb-4\",\n          children: \"Document Viewer\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 270,\n          columnNumber: 11\n        }, this), loading && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-gray-500\",\n          children: \"Loading document...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 271,\n          columnNumber: 23\n        }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-red-500\",\n          children: error\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 272,\n          columnNumber: 21\n        }, this), sigActionError && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-red-500\",\n          children: sigActionError\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 273,\n          columnNumber: 30\n        }, this), finalizeError && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-red-500\",\n          children: finalizeError\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 274,\n          columnNumber: 29\n        }, this), pdfBlobUrl && !loading && !error && /*#__PURE__*/_jsxDEV(PDFRenderer, {\n          file: pdfBlobUrl,\n          pageNumber: currentPage,\n          signatureFields: signatureFields,\n          onPageClick: pendingSignature ? handlePageClick : undefined,\n          onUpdateField: docInfo && docInfo.status !== 'completed' ? handleUpdateField : undefined,\n          onRemoveField: docInfo && docInfo.status !== 'completed' ? handleRemoveField : undefined,\n          onFieldSelect: setSelectedFieldId,\n          selectedFieldId: selectedFieldId,\n          onPageChange: setCurrentPage,\n          initialPage: currentPage,\n          pageDims: pageDims,\n          isEditable: docInfo && docInfo.status !== 'completed',\n          onPageDims: setPdfPageDims\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 276,\n          columnNumber: 13\n        }, this), !pdfBlobUrl && !loading && !error && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-gray-500\",\n          children: \"No PDF loaded\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 293,\n          columnNumber: 13\n        }, this), docInfo && docInfo.status !== 'completed' && /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"mt-6 px-6 py-3 bg-green-600 text-white rounded-xl font-semibold shadow hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-400 disabled:opacity-50\",\n          onClick: handleFinalizeDownload,\n          disabled: finalizeLoading,\n          \"aria-label\": \"Finalize and download signed PDF\",\n          children: finalizeLoading ? 'Finalizing...' : 'Finalize & Download Signed PDF'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 297,\n          columnNumber: 13\n        }, this), docInfo && docInfo.status === 'completed' && pdfBlobUrl && /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"mt-6 px-6 py-3 bg-blue-600 text-white rounded-xl font-semibold shadow hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-400 disabled:opacity-50\",\n            onClick: () => {\n              const link = document.createElement('a');\n              link.href = pdfBlobUrl;\n              link.setAttribute('download', `${docInfo.originalName || 'signed-document'}.pdf`);\n              document.body.appendChild(link);\n              link.click();\n              link.parentNode.removeChild(link);\n            },\n            \"aria-label\": \"Download signed PDF\",\n            children: \"Download Signed PDF\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 309,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"mt-6 ml-4 px-6 py-3 bg-green-600 text-white rounded-xl font-semibold shadow hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-400 disabled:opacity-50\",\n            onClick: handleShare,\n            \"aria-label\": \"Share signed document\",\n            children: \"Share\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 323,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"fixed bottom-8 right-8 z-40 bg-indigo-600 text-white rounded-full shadow-lg p-4 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-400\",\n          onClick: () => setShowSignatureModal(true),\n          \"aria-label\": \"Add Signature\",\n          disabled: sigActionLoading,\n          children: /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-2xl font-bold\",\n            children: \"+\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 339,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 333,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(SignatureInputModal, {\n          open: showSignatureModal,\n          onClose: () => {\n            setShowSignatureModal(false);\n            setPendingSignature(null);\n          },\n          onSave: handleSignatureSave\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 342,\n          columnNumber: 11\n        }, this), selectedField && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"fixed bottom-8 left-8 bg-white rounded shadow-lg px-4 py-2 text-gray-700 z-40\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"font-semibold\",\n            children: \"Signature Coordinates\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 350,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [\"Page: \", selectedField.page]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 351,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [\"X: \", Math.round(selectedField.x)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 352,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [\"Y: \", Math.round(selectedField.y)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 353,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [\"Width: \", Math.round(selectedField.width)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 354,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [\"Height: \", Math.round(selectedField.height)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 355,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 349,\n          columnNumber: 13\n        }, this), showShareModal && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"bg-white rounded-xl shadow-lg p-8 max-w-md w-full relative\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"absolute top-2 right-2 text-gray-400 hover:text-gray-700\",\n              onClick: () => setShowShareModal(false),\n              children: \"\\xD7\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 362,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n              className: \"text-xl font-bold mb-4\",\n              children: \"Share Signed Document\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 363,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"mb-4\",\n              children: /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"text\",\n                value: shareLink,\n                readOnly: true,\n                className: \"w-full border rounded px-3 py-2 text-gray-700 bg-gray-100\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 365,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 364,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700\",\n              onClick: handleCopyLink,\n              children: \"Copy Link\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 372,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 361,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 360,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 269,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 268,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 239,\n    columnNumber: 5\n  }, this);\n};\n_s(DocumentViewerPage, \"aCK6ZG4SBaYnDGP8/rRM4Vcc3BA=\", false, function () {\n  return [useParams, useAuth];\n});\n_c = DocumentViewerPage;\nexport default DocumentViewerPage;\nvar _c;\n$RefreshReg$(_c, \"DocumentViewerPage\");","map":{"version":3,"names":["React","useState","useEffect","useParams","useAuth","api","PDFRenderer","Header","SignatureInputModal","cssToPDF","jsxDEV","_jsxDEV","Fragment","_Fragment","DEFAULT_SIG_WIDTH","DEFAULT_SIG_HEIGHT","DocumentViewerPage","_s","id","token","user","pdfFile","setPdfFile","docInfo","setDocInfo","loading","setLoading","error","setError","signatureFields","setSignatureFields","showSignatureModal","setShowSignatureModal","pendingSignature","setPendingSignature","selectedFieldId","setSelectedFieldId","pageDims","setPageDims","width","height","currentPage","setCurrentPage","sigActionLoading","setSigActionLoading","sigActionError","setSigActionError","finalizeLoading","setFinalizeLoading","finalizeError","setFinalizeError","pdfBlobUrl","setPdfBlobUrl","pdfPageDims","setPdfPageDims","showShareModal","setShowShareModal","shareLink","setShareLink","fetchDoc","docRes","get","data","document","signers","overlays","filter","s","signatureData","image","map","idx","_id","page","x","y","rotation","signature","type","signerEmail","email","err","_err$response","_err$response$data","response","message","fetchPdfBlob","latestToken","localStorage","getItem","res","responseType","headers","Authorization","blobUrl","window","URL","createObjectURL","_err$response2","_err$response2$data","revokeObjectURL","handlePageClick","dims","scale","console","log","pdfCoords","post","documentId","signerName","firstName","lastName","signatureType","position","_err$response3","_err$response4","_err$response5","_err$response5$data","status","location","href","handleUpdateField","updates","fields","f","handleRemoveField","handleSignatureSave","dataUrl","handleFieldSelect","selectedField","find","handleFinalizeDownload","url","Blob","link","createElement","setAttribute","originalName","body","appendChild","click","parentNode","removeChild","_err$response6","_err$response7","_err$response8","_err$response8$data","handleShare","origin","handleCopyLink","navigator","clipboard","writeText","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","p","Math","max","disabled","title","tabIndex","file","pageNumber","onPageClick","undefined","onUpdateField","onRemoveField","onFieldSelect","onPageChange","initialPage","isEditable","onPageDims","open","onClose","onSave","round","value","readOnly","_c","$RefreshReg$"],"sources":["D:/Doc Sign/client/src/pages/DocumentViewerPage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useParams } from 'react-router-dom';\r\nimport { useAuth, api } from '../context/AuthContext';\r\nimport PDFRenderer from '../components/PDFRenderer';\r\nimport Header from '../components/Header';\r\nimport SignatureInputModal from '../components/SignatureInputModal';\r\nimport { cssToPDF } from '../utils/coordinateTransform';\r\n\r\nconst DEFAULT_SIG_WIDTH = 180;\r\nconst DEFAULT_SIG_HEIGHT = 60;\r\n\r\n// TODO: Integrate signature overlay and placement logic\r\n\r\nconst DocumentViewerPage = () => {\r\n  const { id } = useParams();\r\n  const { token, user } = useAuth();\r\n  const [pdfFile, setPdfFile] = useState(null); // Blob or URL\r\n  const [docInfo, setDocInfo] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [signatureFields, setSignatureFields] = useState([]);\r\n  const [showSignatureModal, setShowSignatureModal] = useState(false);\r\n  const [pendingSignature, setPendingSignature] = useState(null); // { dataUrl, type }\r\n  const [selectedFieldId, setSelectedFieldId] = useState(null);\r\n  const [pageDims, setPageDims] = useState({ width: 900, height: 1200 });\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [sigActionLoading, setSigActionLoading] = useState(false);\r\n  const [sigActionError, setSigActionError] = useState('');\r\n  const [finalizeLoading, setFinalizeLoading] = useState(false);\r\n  const [finalizeError, setFinalizeError] = useState('');\r\n  const [pdfBlobUrl, setPdfBlobUrl] = useState(null);\r\n  const [pdfPageDims, setPdfPageDims] = useState({ width: 900, height: 1200 }); // PDF points\r\n  const [showShareModal, setShowShareModal] = useState(false);\r\n  const [shareLink, setShareLink] = useState('');\r\n\r\n  // Fetch document metadata and signature overlays only.\r\n  useEffect(() => {\r\n    if (!id) return;\r\n    setLoading(true);\r\n    setError('');\r\n    setDocInfo(null);\r\n    setSignatureFields([]);\r\n    const fetchDoc = async () => {\r\n      try {\r\n        // Fetch document metadata\r\n        const docRes = await api.get(`/api/docs/${id}`);\r\n        setDocInfo(docRes.data.document);\r\n        // Map signers/signatureData to overlays\r\n        const signers = docRes.data.document.signers || [];\r\n        const overlays = signers\r\n          .filter(s => s.signatureData && s.signatureData.image)\r\n          .map((s, idx) => ({\r\n            id: s._id || idx,\r\n            page: s.signatureData.page || 1,\r\n            x: s.signatureData.x || 50,\r\n            y: s.signatureData.y || 50,\r\n            width: s.signatureData.width || DEFAULT_SIG_WIDTH,\r\n            height: s.signatureData.height || DEFAULT_SIG_HEIGHT,\r\n            rotation: s.signatureData.rotation || 0,\r\n            signature: { data: s.signatureData.image, type: s.signatureData.type },\r\n            signerEmail: s.email,\r\n          }));\r\n        setSignatureFields(overlays);\r\n      } catch (err) {\r\n        setError(err.response?.data?.message || 'Failed to load document.');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchDoc();\r\n  }, [id, token]);\r\n\r\n  useEffect(() => {\r\n    const fetchPdfBlob = async () => {\r\n      if (!docInfo) return;\r\n      try {\r\n        setLoading(true);\r\n        setError('');\r\n        // Always get the latest JWT from localStorage\r\n        const latestToken = localStorage.getItem('token');\r\n        const res = await api.get(`/api/docs/${docInfo._id}/download`, {\r\n          responseType: 'blob',\r\n          headers: { Authorization: `Bearer ${latestToken}` },\r\n        });\r\n        const blobUrl = window.URL.createObjectURL(res.data);\r\n        setPdfBlobUrl(blobUrl);\r\n      } catch (err) {\r\n        setError(err.response?.data?.message || 'Failed to load PDF.');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchPdfBlob();\r\n    // Clean up blob URL on unmount\r\n    return () => {\r\n      if (pdfBlobUrl) window.URL.revokeObjectURL(pdfBlobUrl);\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [docInfo]);\r\n\r\n  // Handle click-to-place signature field (only if a signature is pending)\r\n  const handlePageClick = async (page, x, y, dims) => {\r\n    if (!pendingSignature || !docInfo) return;\r\n    setSigActionLoading(true);\r\n    setSigActionError('');\r\n    try {\r\n      // Calculate scale between rendered PDF and actual PDF points\r\n      const scale = dims.width / pdfPageDims.width;\r\n      // Debug logging\r\n      console.log('[Signature Placement Debug]');\r\n      console.log('Rendered PDF size (pixels):', dims.width, dims.height);\r\n      console.log('Actual PDF size (points):', pdfPageDims.width, pdfPageDims.height);\r\n      console.log('Click coordinates (pixels):', x, y);\r\n      console.log('Scale (rendered/actual):', scale);\r\n      // Convert to PDF coordinates using actual PDF page size and scale\r\n      const pdfCoords = cssToPDF(x, y, pdfPageDims.height, scale, DEFAULT_SIG_HEIGHT);\r\n      console.log('Calculated PDF coordinates (points):', pdfCoords.x, pdfCoords.y);\r\n      // Save to backend (self-sign)\r\n      await api.post('/api/signatures/self-sign', {\r\n        documentId: docInfo._id,\r\n        signerEmail: user.email,\r\n        signerName: user.firstName + ' ' + user.lastName,\r\n        signatureData: pendingSignature.data,\r\n        signatureType: pendingSignature.type,\r\n        position: {\r\n          page,\r\n          x: pdfCoords.x,\r\n          y: pdfCoords.y,\r\n          width: DEFAULT_SIG_WIDTH,\r\n          height: DEFAULT_SIG_HEIGHT,\r\n          rotation: 0,\r\n          image: pendingSignature.data,\r\n          type: pendingSignature.type,\r\n        },\r\n      });\r\n      // Reload document and overlays\r\n      const docRes = await api.get(`/api/docs/${id}`);\r\n      setDocInfo(docRes.data.document);\r\n      const signers = docRes.data.document.signers || [];\r\n      const overlays = signers\r\n        .filter(s => s.signatureData && s.signatureData.image)\r\n        .map((s, idx) => ({\r\n          id: s._id || idx,\r\n          page: s.signatureData.page || 1,\r\n          x: s.signatureData.x || 50,\r\n          y: s.signatureData.y || 50,\r\n          width: s.signatureData.width || DEFAULT_SIG_WIDTH,\r\n          height: s.signatureData.height || DEFAULT_SIG_HEIGHT,\r\n          rotation: s.signatureData.rotation || 0,\r\n          signature: { data: s.signatureData.image, type: s.signatureData.type },\r\n          signerEmail: s.email,\r\n        }));\r\n      setSignatureFields(overlays);\r\n      setPendingSignature(null);\r\n      setShowSignatureModal(false);\r\n    } catch (err) {\r\n      if (err.response?.status === 401 || err.response?.status === 403) {\r\n        // Redirect to login if unauthorized\r\n        window.location.href = '/login?sessionExpired=true';\r\n        return;\r\n      }\r\n      setSigActionError(err.response?.data?.message || 'Failed to save signature.');\r\n    } finally {\r\n      setSigActionLoading(false);\r\n    }\r\n  };\r\n\r\n  // Update a signature field's position/size/rotation (optional: sync with backend)\r\n  const handleUpdateField = (id, updates) => {\r\n    console.log('[handleUpdateField]', id, updates);\r\n    setSignatureFields(fields => fields.map(f => f.id === id ? { ...f, ...updates } : f));\r\n    // Optionally, sync with backend here\r\n  };\r\n\r\n  // Remove a signature field (optional: sync with backend)\r\n  const handleRemoveField = (id) => {\r\n    setSignatureFields(fields => fields.filter(f => f.id !== id));\r\n    setSelectedFieldId(null);\r\n    // Optionally, sync with backend here\r\n  };\r\n\r\n  // Save signature modal result\r\n  const handleSignatureSave = (dataUrl, type) => {\r\n    setPendingSignature({ data: dataUrl, type });\r\n    setShowSignatureModal(false); // Close the modal after saving\r\n    // Modal closes, user will click to place on PDF\r\n  };\r\n\r\n  // Track selected field for coordinate display\r\n  const handleFieldSelect = (id) => {\r\n    setSelectedFieldId(id);\r\n  };\r\n\r\n  // Get selected field's coordinates (PDF system)\r\n  const selectedField = signatureFields.find(f => f.id === selectedFieldId);\r\n\r\n  // Finalize and download signed PDF\r\n  const handleFinalizeDownload = async () => {\r\n    if (!docInfo) return;\r\n    setFinalizeLoading(true);\r\n    setFinalizeError('');\r\n    try {\r\n      const res = await api.post(`/api/signatures/finalize/${docInfo._id}`, {}, {\r\n        responseType: 'blob',\r\n      });\r\n      // Download the PDF\r\n      const url = window.URL.createObjectURL(new Blob([res.data], { type: 'application/pdf' }));\r\n      const link = document.createElement('a');\r\n      link.href = url;\r\n      link.setAttribute('download', `${docInfo.originalName || 'signed-document'}.pdf`);\r\n      document.body.appendChild(link);\r\n      link.click();\r\n      link.parentNode.removeChild(link);\r\n      window.URL.revokeObjectURL(url);\r\n    } catch (err) {\r\n      if (err.response?.status === 401 || err.response?.status === 403) {\r\n        window.location.href = '/login?sessionExpired=true';\r\n        return;\r\n      }\r\n      setFinalizeError(err.response?.data?.message || 'Failed to finalize and download PDF.');\r\n    } finally {\r\n      setFinalizeLoading(false);\r\n    }\r\n  };\r\n\r\n  // Add share handler\r\n  const handleShare = () => {\r\n    // For demo: use current document's public link or download link\r\n    const link = `${window.location.origin}/document/${docInfo._id}`;\r\n    setShareLink(link);\r\n    setShowShareModal(true);\r\n  };\r\n\r\n  const handleCopyLink = () => {\r\n    navigator.clipboard.writeText(shareLink);\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-screen min-h-0 w-full\">\r\n      <Header />\r\n      {/* Navigation Toolbar restored */}\r\n      <div className=\"h-12 flex items-center justify-center bg-gray-50 border-b border-gray-200 z-10\">\r\n        <button\r\n          className=\"px-3 py-2 bg-gray-200 rounded disabled:opacity-50 font-semibold min-w-[44px] min-h-[36px] focus:outline-none focus:ring-2 focus:ring-indigo-400 mx-1\"\r\n          onClick={() => setCurrentPage((p) => Math.max(1, p - 1))}\r\n          disabled={currentPage <= 1}\r\n          aria-label=\"Previous page\"\r\n          title=\"Previous page\"\r\n          tabIndex={0}\r\n        >\r\n          Previous\r\n        </button>\r\n        <span className=\"text-gray-700 font-medium mx-2\" aria-live=\"polite\">\r\n          Page {currentPage}\r\n        </span>\r\n        <button\r\n          className=\"px-3 py-2 bg-gray-200 rounded disabled:opacity-50 font-semibold min-w-[44px] min-h-[36px] focus:outline-none focus:ring-2 focus:ring-indigo-400 mx-1\"\r\n          onClick={() => setCurrentPage((p) => p + 1)}\r\n          disabled={false} // We'll disable if we know numPages\r\n          aria-label=\"Next page\"\r\n          title=\"Next page\"\r\n          tabIndex={0}\r\n        >\r\n          Next\r\n        </button>\r\n      </div>\r\n      {/* PDF Viewer Container - bulletproof flex layout */}\r\n      <div className=\"flex-1 min-h-0 overflow-auto flex justify-center items-start bg-gray-50\">\r\n        <div className=\"w-full max-w-5xl flex flex-col items-center relative m-auto\">\r\n          <h1 className=\"text-2xl font-bold mb-4\">Document Viewer</h1>\r\n          {loading && <div className=\"text-gray-500\">Loading document...</div>}\r\n          {error && <div className=\"text-red-500\">{error}</div>}\r\n          {sigActionError && <div className=\"text-red-500\">{sigActionError}</div>}\r\n          {finalizeError && <div className=\"text-red-500\">{finalizeError}</div>}\r\n          {pdfBlobUrl && !loading && !error && (\r\n            <PDFRenderer\r\n              file={pdfBlobUrl}\r\n              pageNumber={currentPage}\r\n              signatureFields={signatureFields}\r\n              onPageClick={pendingSignature ? handlePageClick : undefined}\r\n              onUpdateField={docInfo && docInfo.status !== 'completed' ? handleUpdateField : undefined}\r\n              onRemoveField={docInfo && docInfo.status !== 'completed' ? handleRemoveField : undefined}\r\n              onFieldSelect={setSelectedFieldId}\r\n              selectedFieldId={selectedFieldId}\r\n              onPageChange={setCurrentPage}\r\n              initialPage={currentPage}\r\n              pageDims={pageDims}\r\n              isEditable={docInfo && docInfo.status !== 'completed'}\r\n              onPageDims={setPdfPageDims}\r\n            />\r\n          )}\r\n          {!pdfBlobUrl && !loading && !error && (\r\n            <div className=\"text-gray-500\">No PDF loaded</div>\r\n          )}\r\n          {/* Finalize & Download Button */}\r\n          {docInfo && docInfo.status !== 'completed' && (\r\n            <button\r\n              className=\"mt-6 px-6 py-3 bg-green-600 text-white rounded-xl font-semibold shadow hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-400 disabled:opacity-50\"\r\n              onClick={handleFinalizeDownload}\r\n              disabled={finalizeLoading}\r\n              aria-label=\"Finalize and download signed PDF\"\r\n            >\r\n              {finalizeLoading ? 'Finalizing...' : 'Finalize & Download Signed PDF'}\r\n            </button>\r\n          )}\r\n          {/* Download Signed PDF Button for completed docs */}\r\n          {docInfo && docInfo.status === 'completed' && pdfBlobUrl && (\r\n            <>\r\n              <button\r\n                className=\"mt-6 px-6 py-3 bg-blue-600 text-white rounded-xl font-semibold shadow hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-400 disabled:opacity-50\"\r\n                onClick={() => {\r\n                  const link = document.createElement('a');\r\n                  link.href = pdfBlobUrl;\r\n                  link.setAttribute('download', `${docInfo.originalName || 'signed-document'}.pdf`);\r\n                  document.body.appendChild(link);\r\n                  link.click();\r\n                  link.parentNode.removeChild(link);\r\n                }}\r\n                aria-label=\"Download signed PDF\"\r\n              >\r\n                Download Signed PDF\r\n              </button>\r\n              <button\r\n                className=\"mt-6 ml-4 px-6 py-3 bg-green-600 text-white rounded-xl font-semibold shadow hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-400 disabled:opacity-50\"\r\n                onClick={handleShare}\r\n                aria-label=\"Share signed document\"\r\n              >\r\n                Share\r\n              </button>\r\n            </>\r\n          )}\r\n          {/* Floating Add Signature Button */}\r\n          <button\r\n            className=\"fixed bottom-8 right-8 z-40 bg-indigo-600 text-white rounded-full shadow-lg p-4 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-400\"\r\n            onClick={() => setShowSignatureModal(true)}\r\n            aria-label=\"Add Signature\"\r\n            disabled={sigActionLoading}\r\n          >\r\n            <span className=\"text-2xl font-bold\">+</span>\r\n          </button>\r\n          {/* Signature Creation Modal */}\r\n          <SignatureInputModal\r\n            open={showSignatureModal}\r\n            onClose={() => { setShowSignatureModal(false); setPendingSignature(null); }}\r\n            onSave={handleSignatureSave}\r\n          />\r\n          {/* Real-time coordinate display for selected field */}\r\n          {selectedField && (\r\n            <div className=\"fixed bottom-8 left-8 bg-white rounded shadow-lg px-4 py-2 text-gray-700 z-40\">\r\n              <div className=\"font-semibold\">Signature Coordinates</div>\r\n              <div>Page: {selectedField.page}</div>\r\n              <div>X: {Math.round(selectedField.x)}</div>\r\n              <div>Y: {Math.round(selectedField.y)}</div>\r\n              <div>Width: {Math.round(selectedField.width)}</div>\r\n              <div>Height: {Math.round(selectedField.height)}</div>\r\n            </div>\r\n          )}\r\n          {/* Share Modal */}\r\n          {showShareModal && (\r\n            <div className=\"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50\">\r\n              <div className=\"bg-white rounded-xl shadow-lg p-8 max-w-md w-full relative\">\r\n                <button className=\"absolute top-2 right-2 text-gray-400 hover:text-gray-700\" onClick={() => setShowShareModal(false)}>&times;</button>\r\n                <h2 className=\"text-xl font-bold mb-4\">Share Signed Document</h2>\r\n                <div className=\"mb-4\">\r\n                  <input\r\n                    type=\"text\"\r\n                    value={shareLink}\r\n                    readOnly\r\n                    className=\"w-full border rounded px-3 py-2 text-gray-700 bg-gray-100\"\r\n                  />\r\n                </div>\r\n                <button\r\n                  className=\"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700\"\r\n                  onClick={handleCopyLink}\r\n                >\r\n                  Copy Link\r\n                </button>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default DocumentViewerPage; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}