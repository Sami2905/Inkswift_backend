{"ast":null,"code":"var _jsxFileName = \"D:\\\\Doc Sign\\\\client\\\\src\\\\pages\\\\DocumentViewerPage.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState, useRef } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { Document, Page, pdfjs } from 'react-pdf';\nimport { useAuth, api } from '../context/AuthContext';\nimport PDFRenderer from '../components/PDFRenderer';\nimport MinimalPDFRenderer from '../components/MinimalPDFRenderer';\nimport SimplePDFTest from '../components/SimplePDFTest';\nimport SignaturePalette from '../components/SignaturePalette';\nimport InviteSignersModal from '../components/InviteSignersModal';\nimport Header from '../components/Header';\nimport Confetti from '../components/Confetti';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport toast from 'react-hot-toast';\nimport { embedSignaturesWithTransform, embedSignaturesSimple } from '../utils/pdfEmbedWithTransform';\nimport { useSignatureStore } from '../utils/useSignatureStore';\nimport SignatureInputModal from '../components/SignatureInputModal';\nimport PDFStandaloneTest from '../components/PDFStandaloneTest';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\npdfjs.GlobalWorkerOptions.workerSrc = `//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjs.version}/pdf.worker.js`;\n\n// Utility to clone an ArrayBuffer\nfunction cloneArrayBuffer(buf) {\n  return buf.slice(0);\n}\nconst DocumentViewerPage = () => {\n  _s();\n  const {\n    id\n  } = useParams();\n  const {\n    token,\n    user\n  } = useAuth();\n  const [doc, setDoc] = useState(null);\n  const [pdfUrl, setPdfUrl] = useState(null);\n  const [pdfBlob, setPdfBlob] = useState(null);\n  const [pdfBuffer, setPdfBuffer] = useState(null);\n  const [numPages, setNumPages] = useState(null);\n  const [pageNumber, setPageNumber] = useState(1);\n  const [scale, setScale] = useState(1.0);\n  const [rotation, setRotation] = useState(0);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n  const [signatureFields, setSignatureFields] = useState([]);\n  const [signatures, setSignatures] = useState([]);\n  const [selectedSignature, setSelectedSignature] = useState(null);\n  const [showSidebar, setShowSidebar] = useState(true);\n  const [inviteModalOpen, setInviteModalOpen] = useState(false);\n  const [signers, setSigners] = useState([]);\n  const [inviteLoading, setInviteLoading] = useState(false);\n  const [showConfetti, setShowConfetti] = useState(false);\n  const [isProcessing, setIsProcessing] = useState(false);\n  const signatureStore = useSignatureStore();\n  const [showSignatureModal, setShowSignatureModal] = useState(false);\n  const [activeSignature, setActiveSignature] = useState(null);\n  const [selectedPlacedSignatureId, setSelectedPlacedSignatureId] = useState(null);\n  const containerRef = useRef();\n  const [pdfSource, setPdfSource] = useState('blob'); // 'blob', 'url', 'public'\n  const publicPdfUrl = 'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf';\n  useEffect(() => {\n    const fetchDoc = async () => {\n      setLoading(true);\n      setError('');\n      try {\n        let authToken = token || localStorage.getItem('token');\n        console.log('Fetching document with ID:', id);\n        console.log('Using auth token:', authToken ? 'Present' : 'Missing');\n        const res = await api.get(`/api/docs/${id}`, {\n          headers: {\n            Authorization: `Bearer ${authToken}`\n          }\n        });\n        console.log('Document data received:', res.data);\n        setDoc(res.data.document);\n\n        // Fetch PDF as blob\n        console.log('Fetching PDF blob...');\n        const pdfRes = await api.get(`/api/docs/${id}/download`, {\n          headers: {\n            Authorization: `Bearer ${authToken}`\n          },\n          responseType: 'blob'\n        });\n        console.log('PDF blob received:', {\n          size: pdfRes.data.size,\n          type: pdfRes.data.type,\n          lastModified: pdfRes.data.lastModified\n        });\n        const blob = new Blob([pdfRes.data], {\n          type: 'application/pdf'\n        });\n        console.log('Created blob:', {\n          size: blob.size,\n          type: blob.type\n        });\n        const url = URL.createObjectURL(blob);\n        console.log('Created object URL:', url);\n        setPdfUrl(url);\n        setPdfBlob(blob);\n\n        // Convert blob to ArrayBuffer for pdf-lib\n        const arrayBuffer = await blob.arrayBuffer();\n        console.log('Converted to ArrayBuffer, size:', arrayBuffer.byteLength);\n        setPdfBuffer(arrayBuffer);\n        toast.success('Document loaded successfully!');\n      } catch (err) {\n        var _err$response, _err$response2, _err$response3;\n        console.error('Document fetch error:', err);\n        console.error('Error details:', {\n          message: err.message,\n          status: (_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.status,\n          statusText: (_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : _err$response2.statusText,\n          data: (_err$response3 = err.response) === null || _err$response3 === void 0 ? void 0 : _err$response3.data\n        });\n        setError('Failed to load document.');\n        toast.error('Failed to load document');\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchDoc();\n    return () => {\n      if (pdfUrl) {\n        console.log('Cleaning up object URL:', pdfUrl);\n        URL.revokeObjectURL(pdfUrl);\n      }\n      if (pdfBlob) {\n        console.log('Cleaning up PDF blob');\n        setPdfBlob(null);\n      }\n    };\n  }, [id, token]);\n  useEffect(() => {\n    if (!inviteModalOpen) return;\n    const fetchSigners = async () => {\n      try {\n        const res = await api.get(`/api/docs/${id}/signers`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        setSigners(res.data.signers || []);\n      } catch (err) {\n        console.error('Signers fetch error:', err);\n        setSigners([]);\n      }\n    };\n    fetchSigners();\n  }, [inviteModalOpen, id, token]);\n  const handleAddSignature = signature => {\n    setSignatures(prev => [...prev, signature]);\n    setSelectedSignature(signature);\n    toast.success('Signature created successfully!');\n  };\n  const handleSelectSignature = sig => {\n    setActiveSignature(sig);\n  };\n  const handleDeleteSignature = signatureId => {\n    setSignatures(prev => prev.filter(s => s.id !== signatureId));\n    if ((selectedSignature === null || selectedSignature === void 0 ? void 0 : selectedSignature.id) === signatureId) {\n      setSelectedSignature(null);\n    }\n    toast.success('Signature deleted');\n  };\n  const handleAddField = newField => {\n    if (!selectedSignature) {\n      toast.error('Please select a signature first');\n      return;\n    }\n    setSignatureFields(prev => [...prev, newField]);\n    toast.success('Signature field added!');\n  };\n  const handleFieldUpdate = updatedField => {\n    setSignatureFields(fields => fields.map(f => f.id === updatedField.id ? updatedField : f));\n  };\n  const handleFieldDelete = fieldId => {\n    setSignatureFields(fields => fields.filter(f => f.id !== fieldId));\n    toast.success('Signature field removed');\n  };\n  const handleClearAll = () => {\n    setSignatureFields([]);\n    toast.success('All signature fields cleared');\n  };\n  const handleInviteSigner = async ({\n    email,\n    name,\n    position\n  }) => {\n    setInviteLoading(true);\n    try {\n      await api.post('/api/signatures', {\n        documentId: id,\n        signerEmail: email,\n        signerName: name,\n        position\n      }, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      const res = await api.get(`/api/docs/${id}/signers`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      setSigners(res.data.signers || []);\n      toast.success('Signer invited successfully!');\n    } catch (err) {\n      console.error('Invite signer error:', err);\n      toast.error('Failed to invite signer');\n    } finally {\n      setInviteLoading(false);\n    }\n  };\n  const handleDownload = async () => {\n    try {\n      const res = await api.get(`/api/docs/${id}/download`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        },\n        responseType: 'blob'\n      });\n      const url = window.URL.createObjectURL(new Blob([res.data]));\n      const link = document.createElement('a');\n      link.href = url;\n      link.setAttribute('download', (doc === null || doc === void 0 ? void 0 : doc.originalName) || 'document.pdf');\n      document.body.appendChild(link);\n      link.click();\n      link.parentNode.removeChild(link);\n      setTimeout(() => window.URL.revokeObjectURL(url), 1000);\n      toast.success('Document downloaded successfully!');\n    } catch (err) {\n      console.error('Download error:', err);\n      toast.error('Failed to download document');\n    }\n  };\n  const handlePrint = () => {\n    window.print();\n    toast.success('Print dialog opened');\n  };\n\n  // Utility: filter out invalid signatures\n  const isValidSignature = sig => typeof sig.page === 'number' && typeof sig.x === 'number' && typeof sig.y === 'number' && typeof sig.width === 'number' && typeof sig.height === 'number' && sig.data;\n\n  // Filtered signatures for rendering and embedding\n  const validSignatures = signatureStore.signatures.filter(isValidSignature);\n  const mappedSignatures = validSignatures.map(sig => ({\n    ...sig,\n    onUpdate: (id, updates) => signatureStore.updateSignature(id, updates),\n    onDelete: id => signatureStore.removeSignature(id),\n    onSelect: () => setSelectedPlacedSignatureId(sig.id),\n    isSelected: selectedPlacedSignatureId === sig.id\n  }));\n  const handleFinalize = async () => {\n    if (!pdfBuffer || validSignatures.length === 0) {\n      toast.error('No signatures to embed or PDF not loaded');\n      return;\n    }\n    setIsProcessing(true);\n    toast.loading('Embedding signatures into PDF...', {\n      id: 'finalize'\n    });\n    try {\n      // Map signatures to expected format for embedSignaturesSimple\n      const embedFields = validSignatures.map(sig => ({\n        page: sig.page,\n        x: sig.x,\n        y: sig.y,\n        width: sig.width,\n        height: sig.height,\n        rotation: sig.rotation || 0,\n        signature: {\n          data: sig.data\n        }\n      }));\n      // Print debug info for each signature\n      console.log('On-screen signature data:', validSignatures);\n      console.log('PDF embedFields:', embedFields);\n      // Check signature data format\n      embedFields.forEach((f, i) => {\n        if (!f.signature.data.startsWith('data:image/')) {\n          console.warn(`Signature ${i} data is not a valid base64 image:`, f.signature.data.slice(0, 30));\n        }\n      });\n      // Log page height for each signature using a clone\n      if (pdfBuffer) {\n        const pdfjsLib = await import('pdfjs-dist/build/pdf');\n        const loadingTask = pdfjsLib.getDocument({\n          data: cloneArrayBuffer(pdfBuffer)\n        });\n        const pdf = await loadingTask.promise;\n        for (const sig of embedFields) {\n          const page = await pdf.getPage(sig.page);\n          const viewport = page.getViewport({\n            scale: 1\n          });\n          console.log(`Signature for page ${sig.page}: x=${sig.x}, y=${sig.y}, width=${sig.width}, height=${sig.height}, pageHeight=${viewport.height}`);\n        }\n      }\n      // Use only the simple embedding method for now\n      const {\n        embedSignaturesSimple\n      } = await import('../utils/pdfEmbedWithTransform');\n      const modifiedPdfBytes = await embedSignaturesSimple(cloneArrayBuffer(pdfBuffer), embedFields);\n      if (!modifiedPdfBytes) {\n        toast.error('No signatures were embedded in the PDF.', {\n          id: 'finalize'\n        });\n        setIsProcessing(false);\n        return;\n      }\n      const blob = new Blob([modifiedPdfBytes], {\n        type: 'application/pdf'\n      });\n      const url = window.URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.setAttribute('download', `signed-${(doc === null || doc === void 0 ? void 0 : doc.originalName) || 'document.pdf'}`);\n      document.body.appendChild(link);\n      link.click();\n      link.parentNode.removeChild(link);\n      setTimeout(() => window.URL.revokeObjectURL(url), 1000);\n      setShowConfetti(true);\n      toast.success('PDF signed and downloaded!', {\n        id: 'finalize'\n      });\n      signatureStore.clearSignatures();\n    } catch (err) {\n      console.error('PDF embedding error:', err);\n      toast.error('Failed to embed signatures.', {\n        id: 'finalize'\n      });\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  // Debug overlay for signature placement\n  useEffect(() => {\n    if (validSignatures.length > 0) {\n      console.log('Signature debug overlay:', validSignatures);\n    }\n  }, [validSignatures]);\n\n  // Click-to-place: when user clicks a page\n  const handlePlaceSignature = (page, x, y) => {\n    if (!activeSignature) return;\n    const newInstance = {\n      id: Date.now() + Math.random(),\n      page,\n      x,\n      y,\n      width: 180,\n      height: 60,\n      type: activeSignature.type,\n      data: activeSignature.data\n    };\n    if (isValidSignature(newInstance)) {\n      signatureStore.addSignature(newInstance);\n      setActiveSignature(null);\n    } else {\n      toast.error('Invalid signature placement');\n    }\n  };\n\n  // Delete handler for placed signatures\n  const handleDeletePlaced = id => {\n    signatureStore.removeSignature(id);\n  };\n\n  // Add signature to global store and close modal\n  const handleSaveSignature = (data, type) => {\n    const newSignature = {\n      id: Date.now() + Math.random(),\n      data,\n      type,\n      createdAt: new Date().toISOString(),\n      name: `Signature ${signatureStore.signatures.length + 1}`\n    };\n    signatureStore.addSignature(newSignature);\n    setShowSignatureModal(false);\n  };\n\n  // Update placed signature (move, resize, rotate)\n  const handleUpdatePlacedSignature = (id, updates) => {\n    signatureStore.updateSignature(id, updates);\n  };\n\n  // Deselect on click outside\n  useEffect(() => {\n    const handleClick = e => {\n      if (containerRef.current && !containerRef.current.contains(e.target)) {\n        setSelectedPlacedSignatureId(null);\n      }\n    };\n    document.addEventListener('mousedown', handleClick);\n    return () => document.removeEventListener('mousedown', handleClick);\n  }, []);\n  const containerVariants = {\n    hidden: {\n      opacity: 0\n    },\n    visible: {\n      opacity: 1,\n      transition: {\n        duration: 0.3,\n        staggerChildren: 0.1\n      }\n    }\n  };\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"min-h-screen bg-gray-50 flex items-center justify-center\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 403,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-gray-600\",\n          children: \"Loading document...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 404,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 402,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 401,\n      columnNumber: 7\n    }, this);\n  }\n  if (error) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"min-h-screen bg-gray-50 flex items-center justify-center\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-red-500 mb-4\",\n          children: /*#__PURE__*/_jsxDEV(\"svg\", {\n            className: \"w-12 h-12 mx-auto\",\n            fill: \"none\",\n            stroke: \"currentColor\",\n            viewBox: \"0 0 24 24\",\n            children: /*#__PURE__*/_jsxDEV(\"path\", {\n              strokeLinecap: \"round\",\n              strokeLinejoin: \"round\",\n              strokeWidth: 2,\n              d: \"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 416,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 415,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 414,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-gray-600\",\n          children: error\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 419,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 413,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 412,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(PDFStandaloneTest, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 427,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: 'fixed',\n        top: 0,\n        left: 0,\n        width: '100vw',\n        zIndex: 9999\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-full bg-yellow-400 text-black text-center font-bold py-2 text-lg\",\n        children: \"PDFRenderer ACTIVE - DEBUG MODE (TOP OF PAGE)\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 430,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center justify-center mb-0 space-x-6 p-4 bg-pink-300 border-4 border-pink-600 rounded-xl\",\n        style: {\n          fontSize: '1.5rem',\n          fontWeight: 'bold'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"text-black\",\n          children: \"PDF Source:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 432,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => setPdfSource('blob'),\n          className: `px-6 py-3 rounded-xl border-4 ${pdfSource === 'blob' ? 'bg-indigo-600 text-white border-indigo-800' : 'bg-white text-indigo-800 border-indigo-400'} transition-all`,\n          children: \"Blob\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 433,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => setPdfSource('url'),\n          className: `px-6 py-3 rounded-xl border-4 ${pdfSource === 'url' ? 'bg-green-600 text-white border-green-800' : 'bg-white text-green-800 border-green-400'} transition-all`,\n          children: \"Object URL\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 434,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => setPdfSource('public'),\n          className: `px-6 py-3 rounded-xl border-4 ${pdfSource === 'public' ? 'bg-yellow-500 text-black border-yellow-800' : 'bg-white text-yellow-800 border-yellow-400'} transition-all`,\n          children: \"Public PDF\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 435,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 431,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-full bg-green-300 text-black text-center font-bold py-2 text-lg\",\n        children: \"PDFRenderer BUTTONS DEBUG BANNER (TOP OF PAGE)\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 437,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 429,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Header, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 439,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(motion.main, {\n      className: \"w-full h-[calc(100vh-64px)] min-h-0 min-w-0 flex flex-row bg-gray-50\",\n      variants: containerVariants,\n      initial: \"hidden\",\n      animate: \"visible\",\n      children: [/*#__PURE__*/_jsxDEV(SignaturePalette, {\n        signatures: signatureStore.signatures,\n        onAddSignature: () => setShowSignatureModal(true),\n        onSelectSignature: handleSelectSignature,\n        selectedSignatureId: activeSignature === null || activeSignature === void 0 ? void 0 : activeSignature.id\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 447,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex-1 min-w-0 min-h-0 flex flex-col\",\n        children: /*#__PURE__*/_jsxDEV(PDFRenderer, {\n          file: pdfBlob,\n          scale: scale,\n          signatures: mappedSignatures,\n          activeSignature: activeSignature,\n          onPlaceSignature: handlePlaceSignature\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 459,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 454,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 440,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"fixed bottom-6 right-6 flex flex-col space-y-3 z-40\",\n      children: [/*#__PURE__*/_jsxDEV(motion.button, {\n        className: \"bg-indigo-600 text-white p-3 rounded-full shadow-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-400\",\n        onClick: () => setShowSignatureModal(true),\n        whileHover: {\n          scale: 1.1\n        },\n        whileTap: {\n          scale: 0.9\n        },\n        \"aria-label\": \"Add new signature\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"sr-only\",\n          children: \"Add new signature\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 480,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"svg\", {\n          className: \"w-6 h-6\",\n          fill: \"none\",\n          stroke: \"currentColor\",\n          viewBox: \"0 0 24 24\",\n          children: /*#__PURE__*/_jsxDEV(\"path\", {\n            strokeLinecap: \"round\",\n            strokeLinejoin: \"round\",\n            strokeWidth: 2,\n            d: \"M15.232 5.232l3.536 3.536M4 17.25V21h3.75l10.606-10.606a2.121 2.121 0 00-3-3L4 17.25z\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 482,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 481,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 473,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(motion.button, {\n        className: `p-3 rounded-full shadow-lg focus:outline-none focus:ring-2 focus:ring-emerald-400 text-white text-lg font-semibold transition-colors ${signatureStore.signatures.length === 0 || isProcessing ? 'bg-gray-400 cursor-not-allowed' : 'bg-emerald-600 hover:bg-emerald-700'}`,\n        onClick: handleFinalize,\n        disabled: signatureStore.signatures.length === 0 || isProcessing,\n        whileHover: {\n          scale: signatureStore.signatures.length === 0 || isProcessing ? 1 : 1.1\n        },\n        whileTap: {\n          scale: signatureStore.signatures.length === 0 || isProcessing ? 1 : 0.9\n        },\n        \"aria-label\": \"Save and Download Signed PDF\",\n        initial: {\n          scale: 0\n        },\n        animate: {\n          scale: 1\n        },\n        transition: {\n          type: \"spring\",\n          stiffness: 300\n        },\n        children: isProcessing ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"animate-spin rounded-full h-6 w-6 border-b-2 border-white\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 503,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n            className: \"w-6 h-6 inline-block mr-2\",\n            fill: \"none\",\n            stroke: \"currentColor\",\n            viewBox: \"0 0 24 24\",\n            children: /*#__PURE__*/_jsxDEV(\"path\", {\n              strokeLinecap: \"round\",\n              strokeLinejoin: \"round\",\n              strokeWidth: 2,\n              d: \"M12 16v-8m0 8l-4-4m4 4l4-4\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 507,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 506,\n            columnNumber: 15\n          }, this), \"Save & Download\"]\n        }, void 0, true)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 487,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 471,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(InviteSignersModal, {\n      open: inviteModalOpen,\n      onClose: () => setInviteModalOpen(false),\n      onInvite: handleInviteSigner,\n      signers: signers.map(s => ({\n        id: s.token,\n        email: s.email,\n        status: s.status,\n        link: s.token ? `${window.location.origin}/sign/${s.token}` : undefined\n      })),\n      loading: inviteLoading\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 516,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Confetti, {\n      isActive: showConfetti,\n      onComplete: () => setShowConfetti(false)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 530,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(SignatureInputModal, {\n      open: showSignatureModal,\n      onClose: () => setShowSignatureModal(false),\n      onSave: handleSaveSignature\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 536,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n};\n_s(DocumentViewerPage, \"yW6Vu91d5O644wJ9z/yFQFsm2Yk=\", false, function () {\n  return [useParams, useAuth, useSignatureStore];\n});\n_c = DocumentViewerPage;\nexport default DocumentViewerPage;\nvar _c;\n$RefreshReg$(_c, \"DocumentViewerPage\");","map":{"version":3,"names":["React","useEffect","useState","useRef","useParams","Document","Page","pdfjs","useAuth","api","PDFRenderer","MinimalPDFRenderer","SimplePDFTest","SignaturePalette","InviteSignersModal","Header","Confetti","motion","AnimatePresence","toast","embedSignaturesWithTransform","embedSignaturesSimple","useSignatureStore","SignatureInputModal","PDFStandaloneTest","jsxDEV","_jsxDEV","Fragment","_Fragment","GlobalWorkerOptions","workerSrc","version","cloneArrayBuffer","buf","slice","DocumentViewerPage","_s","id","token","user","doc","setDoc","pdfUrl","setPdfUrl","pdfBlob","setPdfBlob","pdfBuffer","setPdfBuffer","numPages","setNumPages","pageNumber","setPageNumber","scale","setScale","rotation","setRotation","loading","setLoading","error","setError","signatureFields","setSignatureFields","signatures","setSignatures","selectedSignature","setSelectedSignature","showSidebar","setShowSidebar","inviteModalOpen","setInviteModalOpen","signers","setSigners","inviteLoading","setInviteLoading","showConfetti","setShowConfetti","isProcessing","setIsProcessing","signatureStore","showSignatureModal","setShowSignatureModal","activeSignature","setActiveSignature","selectedPlacedSignatureId","setSelectedPlacedSignatureId","containerRef","pdfSource","setPdfSource","publicPdfUrl","fetchDoc","authToken","localStorage","getItem","console","log","res","get","headers","Authorization","data","document","pdfRes","responseType","size","type","lastModified","blob","Blob","url","URL","createObjectURL","arrayBuffer","byteLength","success","err","_err$response","_err$response2","_err$response3","message","status","response","statusText","revokeObjectURL","fetchSigners","handleAddSignature","signature","prev","handleSelectSignature","sig","handleDeleteSignature","signatureId","filter","s","handleAddField","newField","handleFieldUpdate","updatedField","fields","map","f","handleFieldDelete","fieldId","handleClearAll","handleInviteSigner","email","name","position","post","documentId","signerEmail","signerName","handleDownload","window","link","createElement","href","setAttribute","originalName","body","appendChild","click","parentNode","removeChild","setTimeout","handlePrint","print","isValidSignature","page","x","y","width","height","validSignatures","mappedSignatures","onUpdate","updates","updateSignature","onDelete","removeSignature","onSelect","isSelected","handleFinalize","length","embedFields","forEach","i","startsWith","warn","pdfjsLib","loadingTask","getDocument","pdf","promise","getPage","viewport","getViewport","modifiedPdfBytes","clearSignatures","handlePlaceSignature","newInstance","Date","now","Math","random","addSignature","handleDeletePlaced","handleSaveSignature","newSignature","createdAt","toISOString","handleUpdatePlacedSignature","handleClick","e","current","contains","target","addEventListener","removeEventListener","containerVariants","hidden","opacity","visible","transition","duration","staggerChildren","className","children","fileName","_jsxFileName","lineNumber","columnNumber","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","style","top","left","zIndex","fontSize","fontWeight","onClick","main","variants","initial","animate","onAddSignature","onSelectSignature","selectedSignatureId","file","onPlaceSignature","button","whileHover","whileTap","disabled","stiffness","open","onClose","onInvite","location","origin","undefined","isActive","onComplete","onSave","_c","$RefreshReg$"],"sources":["D:/Doc Sign/client/src/pages/DocumentViewerPage.js"],"sourcesContent":["import React, { useEffect, useState, useRef } from 'react';\r\nimport { useParams } from 'react-router-dom';\r\nimport { Document, Page, pdfjs } from 'react-pdf';\r\nimport { useAuth, api } from '../context/AuthContext';\r\nimport PDFRenderer from '../components/PDFRenderer';\r\nimport MinimalPDFRenderer from '../components/MinimalPDFRenderer';\r\nimport SimplePDFTest from '../components/SimplePDFTest';\r\nimport SignaturePalette from '../components/SignaturePalette';\r\nimport InviteSignersModal from '../components/InviteSignersModal';\r\nimport Header from '../components/Header';\r\nimport Confetti from '../components/Confetti';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport toast from 'react-hot-toast';\r\nimport { embedSignaturesWithTransform, embedSignaturesSimple } from '../utils/pdfEmbedWithTransform';\r\nimport { useSignatureStore } from '../utils/useSignatureStore';\r\nimport SignatureInputModal from '../components/SignatureInputModal';\r\nimport PDFStandaloneTest from '../components/PDFStandaloneTest';\r\n\r\npdfjs.GlobalWorkerOptions.workerSrc = `//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjs.version}/pdf.worker.js`;\r\n\r\n// Utility to clone an ArrayBuffer\r\nfunction cloneArrayBuffer(buf) {\r\n  return buf.slice(0);\r\n}\r\n\r\nconst DocumentViewerPage = () => {\r\n  const { id } = useParams();\r\n  const { token, user } = useAuth();\r\n  const [doc, setDoc] = useState(null);\r\n  const [pdfUrl, setPdfUrl] = useState(null);\r\n  const [pdfBlob, setPdfBlob] = useState(null);\r\n  const [pdfBuffer, setPdfBuffer] = useState(null);\r\n  const [numPages, setNumPages] = useState(null);\r\n  const [pageNumber, setPageNumber] = useState(1);\r\n  const [scale, setScale] = useState(1.0);\r\n  const [rotation, setRotation] = useState(0);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n  const [signatureFields, setSignatureFields] = useState([]);\r\n  const [signatures, setSignatures] = useState([]);\r\n  const [selectedSignature, setSelectedSignature] = useState(null);\r\n  const [showSidebar, setShowSidebar] = useState(true);\r\n  const [inviteModalOpen, setInviteModalOpen] = useState(false);\r\n  const [signers, setSigners] = useState([]);\r\n  const [inviteLoading, setInviteLoading] = useState(false);\r\n  const [showConfetti, setShowConfetti] = useState(false);\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  const signatureStore = useSignatureStore();\r\n  const [showSignatureModal, setShowSignatureModal] = useState(false);\r\n  const [activeSignature, setActiveSignature] = useState(null);\r\n  const [selectedPlacedSignatureId, setSelectedPlacedSignatureId] = useState(null);\r\n  const containerRef = useRef();\r\n  const [pdfSource, setPdfSource] = useState('blob'); // 'blob', 'url', 'public'\r\n  const publicPdfUrl = 'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf';\r\n\r\n  useEffect(() => {\r\n    const fetchDoc = async () => {\r\n      setLoading(true);\r\n      setError('');\r\n      try {\r\n        let authToken = token || localStorage.getItem('token');\r\n        console.log('Fetching document with ID:', id);\r\n        console.log('Using auth token:', authToken ? 'Present' : 'Missing');\r\n        \r\n        const res = await api.get(`/api/docs/${id}`, {\r\n          headers: { Authorization: `Bearer ${authToken}` },\r\n        });\r\n        console.log('Document data received:', res.data);\r\n        setDoc(res.data.document);\r\n        \r\n        // Fetch PDF as blob\r\n        console.log('Fetching PDF blob...');\r\n        const pdfRes = await api.get(`/api/docs/${id}/download`, {\r\n          headers: { Authorization: `Bearer ${authToken}` },\r\n          responseType: 'blob',\r\n        });\r\n        \r\n        console.log('PDF blob received:', {\r\n          size: pdfRes.data.size,\r\n          type: pdfRes.data.type,\r\n          lastModified: pdfRes.data.lastModified\r\n        });\r\n        \r\n        const blob = new Blob([pdfRes.data], { type: 'application/pdf' });\r\n        console.log('Created blob:', {\r\n          size: blob.size,\r\n          type: blob.type\r\n        });\r\n        \r\n        const url = URL.createObjectURL(blob);\r\n        console.log('Created object URL:', url);\r\n        setPdfUrl(url);\r\n        setPdfBlob(blob);\r\n        \r\n        // Convert blob to ArrayBuffer for pdf-lib\r\n        const arrayBuffer = await blob.arrayBuffer();\r\n        console.log('Converted to ArrayBuffer, size:', arrayBuffer.byteLength);\r\n        setPdfBuffer(arrayBuffer);\r\n        \r\n        toast.success('Document loaded successfully!');\r\n      } catch (err) {\r\n        console.error('Document fetch error:', err);\r\n        console.error('Error details:', {\r\n          message: err.message,\r\n          status: err.response?.status,\r\n          statusText: err.response?.statusText,\r\n          data: err.response?.data\r\n        });\r\n        setError('Failed to load document.');\r\n        toast.error('Failed to load document');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchDoc();\r\n    return () => {\r\n      if (pdfUrl) {\r\n        console.log('Cleaning up object URL:', pdfUrl);\r\n        URL.revokeObjectURL(pdfUrl);\r\n      }\r\n      if (pdfBlob) {\r\n        console.log('Cleaning up PDF blob');\r\n        setPdfBlob(null);\r\n      }\r\n    };\r\n  }, [id, token]);\r\n\r\n  useEffect(() => {\r\n    if (!inviteModalOpen) return;\r\n    const fetchSigners = async () => {\r\n      try {\r\n        const res = await api.get(`/api/docs/${id}/signers`, {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        });\r\n        setSigners(res.data.signers || []);\r\n      } catch (err) {\r\n        console.error('Signers fetch error:', err);\r\n        setSigners([]);\r\n      }\r\n    };\r\n    fetchSigners();\r\n  }, [inviteModalOpen, id, token]);\r\n\r\n  const handleAddSignature = (signature) => {\r\n    setSignatures(prev => [...prev, signature]);\r\n    setSelectedSignature(signature);\r\n    toast.success('Signature created successfully!');\r\n  };\r\n\r\n  const handleSelectSignature = (sig) => {\r\n    setActiveSignature(sig);\r\n  };\r\n\r\n  const handleDeleteSignature = (signatureId) => {\r\n    setSignatures(prev => prev.filter(s => s.id !== signatureId));\r\n    if (selectedSignature?.id === signatureId) {\r\n      setSelectedSignature(null);\r\n    }\r\n    toast.success('Signature deleted');\r\n  };\r\n\r\n  const handleAddField = (newField) => {\r\n    if (!selectedSignature) {\r\n      toast.error('Please select a signature first');\r\n      return;\r\n    }\r\n    \r\n    setSignatureFields(prev => [...prev, newField]);\r\n    toast.success('Signature field added!');\r\n  };\r\n\r\n  const handleFieldUpdate = (updatedField) => {\r\n    setSignatureFields(fields => \r\n      fields.map(f => f.id === updatedField.id ? updatedField : f)\r\n    );\r\n  };\r\n\r\n  const handleFieldDelete = (fieldId) => {\r\n    setSignatureFields(fields => fields.filter(f => f.id !== fieldId));\r\n    toast.success('Signature field removed');\r\n  };\r\n\r\n  const handleClearAll = () => {\r\n    setSignatureFields([]);\r\n    toast.success('All signature fields cleared');\r\n  };\r\n\r\n  const handleInviteSigner = async ({ email, name, position }) => {\r\n    setInviteLoading(true);\r\n    try {\r\n      await api.post('/api/signatures', {\r\n        documentId: id,\r\n        signerEmail: email,\r\n        signerName: name,\r\n        position,\r\n      }, {\r\n        headers: { Authorization: `Bearer ${token}` },\r\n      });\r\n      \r\n      const res = await api.get(`/api/docs/${id}/signers`, {\r\n        headers: { Authorization: `Bearer ${token}` },\r\n      });\r\n      setSigners(res.data.signers || []);\r\n      toast.success('Signer invited successfully!');\r\n    } catch (err) {\r\n      console.error('Invite signer error:', err);\r\n      toast.error('Failed to invite signer');\r\n    } finally {\r\n      setInviteLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleDownload = async () => {\r\n    try {\r\n      const res = await api.get(`/api/docs/${id}/download`, {\r\n        headers: { Authorization: `Bearer ${token}` },\r\n        responseType: 'blob',\r\n      });\r\n      const url = window.URL.createObjectURL(new Blob([res.data]));\r\n      const link = document.createElement('a');\r\n      link.href = url;\r\n      link.setAttribute('download', doc?.originalName || 'document.pdf');\r\n      document.body.appendChild(link);\r\n      link.click();\r\n      link.parentNode.removeChild(link);\r\n      setTimeout(() => window.URL.revokeObjectURL(url), 1000);\r\n      toast.success('Document downloaded successfully!');\r\n    } catch (err) {\r\n      console.error('Download error:', err);\r\n      toast.error('Failed to download document');\r\n    }\r\n  };\r\n\r\n  const handlePrint = () => {\r\n    window.print();\r\n    toast.success('Print dialog opened');\r\n  };\r\n\r\n  // Utility: filter out invalid signatures\r\n  const isValidSignature = sig => (\r\n    typeof sig.page === 'number' &&\r\n    typeof sig.x === 'number' &&\r\n    typeof sig.y === 'number' &&\r\n    typeof sig.width === 'number' &&\r\n    typeof sig.height === 'number' &&\r\n    sig.data\r\n  );\r\n\r\n  // Filtered signatures for rendering and embedding\r\n  const validSignatures = signatureStore.signatures.filter(isValidSignature);\r\n\r\n  const mappedSignatures = validSignatures.map(sig => ({\r\n    ...sig,\r\n    onUpdate: (id, updates) => signatureStore.updateSignature(id, updates),\r\n    onDelete: (id) => signatureStore.removeSignature(id),\r\n    onSelect: () => setSelectedPlacedSignatureId(sig.id),\r\n    isSelected: selectedPlacedSignatureId === sig.id,\r\n  }));\r\n\r\n  const handleFinalize = async () => {\r\n    if (!pdfBuffer || validSignatures.length === 0) {\r\n      toast.error('No signatures to embed or PDF not loaded');\r\n      return;\r\n    }\r\n    setIsProcessing(true);\r\n    toast.loading('Embedding signatures into PDF...', { id: 'finalize' });\r\n    try {\r\n      // Map signatures to expected format for embedSignaturesSimple\r\n      const embedFields = validSignatures.map(sig => ({\r\n        page: sig.page,\r\n        x: sig.x,\r\n        y: sig.y,\r\n        width: sig.width,\r\n        height: sig.height,\r\n        rotation: sig.rotation || 0,\r\n        signature: { data: sig.data },\r\n      }));\r\n      // Print debug info for each signature\r\n      console.log('On-screen signature data:', validSignatures);\r\n      console.log('PDF embedFields:', embedFields);\r\n      // Check signature data format\r\n      embedFields.forEach((f, i) => {\r\n        if (!f.signature.data.startsWith('data:image/')) {\r\n          console.warn(`Signature ${i} data is not a valid base64 image:`, f.signature.data.slice(0, 30));\r\n        }\r\n      });\r\n      // Log page height for each signature using a clone\r\n      if (pdfBuffer) {\r\n        const pdfjsLib = await import('pdfjs-dist/build/pdf');\r\n        const loadingTask = pdfjsLib.getDocument({ data: cloneArrayBuffer(pdfBuffer) });\r\n        const pdf = await loadingTask.promise;\r\n        for (const sig of embedFields) {\r\n          const page = await pdf.getPage(sig.page);\r\n          const viewport = page.getViewport({ scale: 1 });\r\n          console.log(`Signature for page ${sig.page}: x=${sig.x}, y=${sig.y}, width=${sig.width}, height=${sig.height}, pageHeight=${viewport.height}`);\r\n        }\r\n      }\r\n      // Use only the simple embedding method for now\r\n      const { embedSignaturesSimple } = await import('../utils/pdfEmbedWithTransform');\r\n      const modifiedPdfBytes = await embedSignaturesSimple(cloneArrayBuffer(pdfBuffer), embedFields);\r\n      if (!modifiedPdfBytes) {\r\n        toast.error('No signatures were embedded in the PDF.', { id: 'finalize' });\r\n        setIsProcessing(false);\r\n        return;\r\n      }\r\n      const blob = new Blob([modifiedPdfBytes], { type: 'application/pdf' });\r\n      const url = window.URL.createObjectURL(blob);\r\n      const link = document.createElement('a');\r\n      link.href = url;\r\n      link.setAttribute('download', `signed-${doc?.originalName || 'document.pdf'}`);\r\n      document.body.appendChild(link);\r\n      link.click();\r\n      link.parentNode.removeChild(link);\r\n      setTimeout(() => window.URL.revokeObjectURL(url), 1000);\r\n      setShowConfetti(true);\r\n      toast.success('PDF signed and downloaded!', { id: 'finalize' });\r\n      signatureStore.clearSignatures();\r\n    } catch (err) {\r\n      console.error('PDF embedding error:', err);\r\n      toast.error('Failed to embed signatures.', { id: 'finalize' });\r\n    } finally {\r\n      setIsProcessing(false);\r\n    }\r\n  };\r\n\r\n  // Debug overlay for signature placement\r\n  useEffect(() => {\r\n    if (validSignatures.length > 0) {\r\n      console.log('Signature debug overlay:', validSignatures);\r\n    }\r\n  }, [validSignatures]);\r\n\r\n  // Click-to-place: when user clicks a page\r\n  const handlePlaceSignature = (page, x, y) => {\r\n    if (!activeSignature) return;\r\n    const newInstance = {\r\n      id: Date.now() + Math.random(),\r\n      page,\r\n      x,\r\n      y,\r\n      width: 180,\r\n      height: 60,\r\n      type: activeSignature.type,\r\n      data: activeSignature.data,\r\n    };\r\n    if (isValidSignature(newInstance)) {\r\n      signatureStore.addSignature(newInstance);\r\n      setActiveSignature(null);\r\n    } else {\r\n      toast.error('Invalid signature placement');\r\n    }\r\n  };\r\n\r\n  // Delete handler for placed signatures\r\n  const handleDeletePlaced = (id) => {\r\n    signatureStore.removeSignature(id);\r\n  };\r\n\r\n  // Add signature to global store and close modal\r\n  const handleSaveSignature = (data, type) => {\r\n    const newSignature = {\r\n      id: Date.now() + Math.random(),\r\n      data,\r\n      type,\r\n      createdAt: new Date().toISOString(),\r\n      name: `Signature ${signatureStore.signatures.length + 1}`\r\n    };\r\n    signatureStore.addSignature(newSignature);\r\n    setShowSignatureModal(false);\r\n  };\r\n\r\n  // Update placed signature (move, resize, rotate)\r\n  const handleUpdatePlacedSignature = (id, updates) => {\r\n    signatureStore.updateSignature(id, updates);\r\n  };\r\n\r\n  // Deselect on click outside\r\n  useEffect(() => {\r\n    const handleClick = (e) => {\r\n      if (containerRef.current && !containerRef.current.contains(e.target)) {\r\n        setSelectedPlacedSignatureId(null);\r\n      }\r\n    };\r\n    document.addEventListener('mousedown', handleClick);\r\n    return () => document.removeEventListener('mousedown', handleClick);\r\n  }, []);\r\n\r\n  const containerVariants = {\r\n    hidden: { opacity: 0 },\r\n    visible: { \r\n      opacity: 1, \r\n      transition: { \r\n        duration: 0.3,\r\n        staggerChildren: 0.1\r\n      } \r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4\"></div>\r\n          <p className=\"text-gray-600\">Loading document...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"text-red-500 mb-4\">\r\n            <svg className=\"w-12 h-12 mx-auto\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n          </div>\r\n          <p className=\"text-gray-600\">{error}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <PDFStandaloneTest />\r\n      {/* EXTREMELY VISIBLE DEBUG BANNERS AND BUTTONS AT TOP OF PAGE */}\r\n      <div style={{ position: 'fixed', top: 0, left: 0, width: '100vw', zIndex: 9999 }}>\r\n        <div className=\"w-full bg-yellow-400 text-black text-center font-bold py-2 text-lg\">PDFRenderer ACTIVE - DEBUG MODE (TOP OF PAGE)</div>\r\n        <div className=\"flex items-center justify-center mb-0 space-x-6 p-4 bg-pink-300 border-4 border-pink-600 rounded-xl\" style={{ fontSize: '1.5rem', fontWeight: 'bold' }}>\r\n          <span className=\"text-black\">PDF Source:</span>\r\n          <button onClick={() => setPdfSource('blob')} className={`px-6 py-3 rounded-xl border-4 ${pdfSource === 'blob' ? 'bg-indigo-600 text-white border-indigo-800' : 'bg-white text-indigo-800 border-indigo-400'} transition-all`}>Blob</button>\r\n          <button onClick={() => setPdfSource('url')} className={`px-6 py-3 rounded-xl border-4 ${pdfSource === 'url' ? 'bg-green-600 text-white border-green-800' : 'bg-white text-green-800 border-green-400'} transition-all`}>Object URL</button>\r\n          <button onClick={() => setPdfSource('public')} className={`px-6 py-3 rounded-xl border-4 ${pdfSource === 'public' ? 'bg-yellow-500 text-black border-yellow-800' : 'bg-white text-yellow-800 border-yellow-400'} transition-all`}>Public PDF</button>\r\n        </div>\r\n        <div className=\"w-full bg-green-300 text-black text-center font-bold py-2 text-lg\">PDFRenderer BUTTONS DEBUG BANNER (TOP OF PAGE)</div>\r\n      </div>\r\n      <Header />\r\n      <motion.main \r\n        className=\"w-full h-[calc(100vh-64px)] min-h-0 min-w-0 flex flex-row bg-gray-50\"\r\n        variants={containerVariants}\r\n        initial=\"hidden\"\r\n        animate=\"visible\"\r\n      >\r\n        {/* Sidebar (Signature Palette) */}\r\n        <SignaturePalette\r\n          signatures={signatureStore.signatures}\r\n          onAddSignature={() => setShowSignatureModal(true)}\r\n          onSelectSignature={handleSelectSignature}\r\n          selectedSignatureId={activeSignature?.id}\r\n        />\r\n        {/* PDF Renderer (center, fills all space) */}\r\n        <div className=\"flex-1 min-w-0 min-h-0 flex flex-col\">\r\n          {/* Minimal PDF Test */}\r\n          {/* <div className=\"mb-4 w-full max-w-2xl\">\r\n            <MinimalPDFRenderer file={pdfBlob} />\r\n          </div> */}\r\n          <PDFRenderer\r\n            file={pdfBlob}\r\n            scale={scale}\r\n            signatures={mappedSignatures}\r\n            activeSignature={activeSignature}\r\n            onPlaceSignature={handlePlaceSignature}\r\n          >\r\n            {/* children if any */}\r\n          </PDFRenderer>\r\n        </div>\r\n      </motion.main>\r\n      {/* Floating Action Buttons, Modals, etc. remain unchanged */}\r\n      <div className=\"fixed bottom-6 right-6 flex flex-col space-y-3 z-40\">\r\n        {/* Pencil button for new signature */}\r\n        <motion.button\r\n          className=\"bg-indigo-600 text-white p-3 rounded-full shadow-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-400\"\r\n          onClick={() => setShowSignatureModal(true)}\r\n          whileHover={{ scale: 1.1 }}\r\n          whileTap={{ scale: 0.9 }}\r\n          aria-label=\"Add new signature\"\r\n        >\r\n          <span className=\"sr-only\">Add new signature</span>\r\n          <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15.232 5.232l3.536 3.536M4 17.25V21h3.75l10.606-10.606a2.121 2.121 0 00-3-3L4 17.25z\" />\r\n          </svg>\r\n        </motion.button>\r\n\r\n        {/* Save & Download button (always visible, iLovePDF style) */}\r\n        <motion.button\r\n          className={`p-3 rounded-full shadow-lg focus:outline-none focus:ring-2 focus:ring-emerald-400 text-white text-lg font-semibold transition-colors ${\r\n            signatureStore.signatures.length === 0 || isProcessing\r\n              ? 'bg-gray-400 cursor-not-allowed' \r\n              : 'bg-emerald-600 hover:bg-emerald-700'\r\n          }`}\r\n          onClick={handleFinalize}\r\n          disabled={signatureStore.signatures.length === 0 || isProcessing}\r\n          whileHover={{ scale: signatureStore.signatures.length === 0 || isProcessing ? 1 : 1.1 }}\r\n          whileTap={{ scale: signatureStore.signatures.length === 0 || isProcessing ? 1 : 0.9 }}\r\n          aria-label=\"Save and Download Signed PDF\"\r\n          initial={{ scale: 0 }}\r\n          animate={{ scale: 1 }}\r\n          transition={{ type: \"spring\", stiffness: 300 }}\r\n        >\r\n          {isProcessing ? (\r\n            <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-white\"></div>\r\n          ) : (\r\n            <>\r\n              <svg className=\"w-6 h-6 inline-block mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 16v-8m0 8l-4-4m4 4l4-4\" />\r\n              </svg>\r\n              Save & Download\r\n            </>\r\n          )}\r\n        </motion.button>\r\n      </div>\r\n\r\n      {/* Modals */}\r\n      <InviteSignersModal\r\n        open={inviteModalOpen}\r\n        onClose={() => setInviteModalOpen(false)}\r\n        onInvite={handleInviteSigner}\r\n        signers={signers.map(s => ({\r\n          id: s.token,\r\n          email: s.email,\r\n          status: s.status,\r\n          link: s.token ? `${window.location.origin}/sign/${s.token}` : undefined,\r\n        }))}\r\n        loading={inviteLoading}\r\n      />\r\n\r\n      {/* Confetti */}\r\n      <Confetti \r\n        isActive={showConfetti} \r\n        onComplete={() => setShowConfetti(false)} \r\n      />\r\n\r\n      {/* Signature Modal */}\r\n      <SignatureInputModal\r\n        open={showSignatureModal}\r\n        onClose={() => setShowSignatureModal(false)}\r\n        onSave={handleSaveSignature}\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default DocumentViewerPage; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}