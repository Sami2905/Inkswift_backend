{"ast":null,"code":"var _jsxFileName = \"D:\\\\Doc Sign\\\\client\\\\src\\\\pages\\\\DocumentViewerPage.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { useAuth, api } from '../context/AuthContext';\nimport PDFRenderer from '../components/PDFRenderer';\nimport Header from '../components/Header';\nimport SignatureInputModal from '../components/SignatureInputModal';\nimport { cssToPDF } from '../utils/coordinateTransform';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst DEFAULT_SIG_WIDTH = 180;\nconst DEFAULT_SIG_HEIGHT = 60;\n\n// TODO: Integrate signature overlay and placement logic\n\nconst DocumentViewerPage = () => {\n  _s();\n  const {\n    id\n  } = useParams();\n  const {\n    token,\n    user\n  } = useAuth();\n  const [pdfFile, setPdfFile] = useState(null); // Blob or URL\n  const [docInfo, setDocInfo] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [signatureFields, setSignatureFields] = useState([]);\n  const [showSignatureModal, setShowSignatureModal] = useState(false);\n  const [pendingSignature, setPendingSignature] = useState(null); // { dataUrl, type }\n  const [selectedFieldId, setSelectedFieldId] = useState(null);\n  const [pageDims, setPageDims] = useState({\n    width: 900,\n    height: 1200\n  });\n  const [currentPage, setCurrentPage] = useState(1);\n  const [sigActionLoading, setSigActionLoading] = useState(false);\n  const [sigActionError, setSigActionError] = useState('');\n  const [finalizeLoading, setFinalizeLoading] = useState(false);\n  const [finalizeError, setFinalizeError] = useState('');\n  const [pdfBlobUrl, setPdfBlobUrl] = useState(null);\n\n  // Fetch document metadata and signature overlays only.\n  useEffect(() => {\n    if (!id) return;\n    setLoading(true);\n    setError('');\n    setDocInfo(null);\n    setSignatureFields([]);\n    const fetchDoc = async () => {\n      try {\n        // Fetch document metadata\n        const docRes = await api.get(`/api/docs/${id}`);\n        setDocInfo(docRes.data.document);\n        // Map signers/signatureData to overlays\n        const signers = docRes.data.document.signers || [];\n        const overlays = signers.filter(s => s.signatureData && s.signatureData.image).map((s, idx) => ({\n          id: s._id || idx,\n          page: s.signatureData.page || 1,\n          x: s.signatureData.x || 50,\n          y: s.signatureData.y || 50,\n          width: s.signatureData.width || DEFAULT_SIG_WIDTH,\n          height: s.signatureData.height || DEFAULT_SIG_HEIGHT,\n          rotation: s.signatureData.rotation || 0,\n          signature: {\n            data: s.signatureData.image,\n            type: s.signatureData.type\n          },\n          signerEmail: s.email\n        }));\n        setSignatureFields(overlays);\n      } catch (err) {\n        var _err$response, _err$response$data;\n        setError(((_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.message) || 'Failed to load document.');\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchDoc();\n  }, [id, token]);\n  useEffect(() => {\n    const fetchPdfBlob = async () => {\n      if (!docInfo) return;\n      try {\n        setLoading(true);\n        setError('');\n        const res = await api.get(`/api/docs/${docInfo._id}/download`, {\n          responseType: 'blob',\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        const blobUrl = window.URL.createObjectURL(res.data);\n        setPdfBlobUrl(blobUrl);\n      } catch (err) {\n        var _err$response2, _err$response2$data;\n        setError(((_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : (_err$response2$data = _err$response2.data) === null || _err$response2$data === void 0 ? void 0 : _err$response2$data.message) || 'Failed to load PDF.');\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchPdfBlob();\n    // Clean up blob URL on unmount\n    return () => {\n      if (pdfBlobUrl) window.URL.revokeObjectURL(pdfBlobUrl);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [docInfo, token]);\n\n  // Handle click-to-place signature field (only if a signature is pending)\n  const handlePageClick = async (page, x, y, dims) => {\n    if (!pendingSignature || !docInfo) return;\n    setSigActionLoading(true);\n    setSigActionError('');\n    try {\n      // Convert to PDF coordinates\n      const pdfCoords = cssToPDF(x, y, dims.height, 1); // scale=1 for now\n      // Save to backend (self-sign)\n      await api.post('/api/signatures/self-sign', {\n        documentId: docInfo._id,\n        signerEmail: user.email,\n        signerName: user.firstName + ' ' + user.lastName,\n        signatureData: pendingSignature.data,\n        signatureType: pendingSignature.type,\n        position: {\n          page,\n          x: pdfCoords.x,\n          y: pdfCoords.y,\n          width: DEFAULT_SIG_WIDTH,\n          height: DEFAULT_SIG_HEIGHT,\n          rotation: 0,\n          image: pendingSignature.data,\n          type: pendingSignature.type\n        }\n      });\n      // Reload document and overlays\n      const docRes = await api.get(`/api/docs/${id}`);\n      setDocInfo(docRes.data.document);\n      const signers = docRes.data.document.signers || [];\n      const overlays = signers.filter(s => s.signatureData && s.signatureData.image).map((s, idx) => ({\n        id: s._id || idx,\n        page: s.signatureData.page || 1,\n        x: s.signatureData.x || 50,\n        y: s.signatureData.y || 50,\n        width: s.signatureData.width || DEFAULT_SIG_WIDTH,\n        height: s.signatureData.height || DEFAULT_SIG_HEIGHT,\n        rotation: s.signatureData.rotation || 0,\n        signature: {\n          data: s.signatureData.image,\n          type: s.signatureData.type\n        },\n        signerEmail: s.email\n      }));\n      setSignatureFields(overlays);\n      setPendingSignature(null);\n      setShowSignatureModal(false);\n    } catch (err) {\n      var _err$response3, _err$response3$data;\n      setSigActionError(((_err$response3 = err.response) === null || _err$response3 === void 0 ? void 0 : (_err$response3$data = _err$response3.data) === null || _err$response3$data === void 0 ? void 0 : _err$response3$data.message) || 'Failed to save signature.');\n    } finally {\n      setSigActionLoading(false);\n    }\n  };\n\n  // Update a signature field's position/size/rotation (optional: sync with backend)\n  const handleUpdateField = (id, updates) => {\n    setSignatureFields(fields => fields.map(f => f.id === id ? {\n      ...f,\n      ...updates\n    } : f));\n    // Optionally, sync with backend here\n  };\n\n  // Remove a signature field (optional: sync with backend)\n  const handleRemoveField = id => {\n    setSignatureFields(fields => fields.filter(f => f.id !== id));\n    setSelectedFieldId(null);\n    // Optionally, sync with backend here\n  };\n\n  // Save signature modal result\n  const handleSignatureSave = (dataUrl, type) => {\n    setPendingSignature({\n      data: dataUrl,\n      type\n    });\n    // Modal closes, user will click to place on PDF\n  };\n\n  // Track selected field for coordinate display\n  const handleFieldSelect = id => {\n    setSelectedFieldId(id);\n  };\n\n  // Get selected field's coordinates (PDF system)\n  const selectedField = signatureFields.find(f => f.id === selectedFieldId);\n\n  // Finalize and download signed PDF\n  const handleFinalizeDownload = async () => {\n    if (!docInfo) return;\n    setFinalizeLoading(true);\n    setFinalizeError('');\n    try {\n      const res = await api.post(`/api/signatures/finalize/${docInfo._id}`, {}, {\n        responseType: 'blob'\n      });\n      // Download the PDF\n      const url = window.URL.createObjectURL(new Blob([res.data], {\n        type: 'application/pdf'\n      }));\n      const link = document.createElement('a');\n      link.href = url;\n      link.setAttribute('download', `${docInfo.originalName || 'signed-document'}.pdf`);\n      document.body.appendChild(link);\n      link.click();\n      link.parentNode.removeChild(link);\n      window.URL.revokeObjectURL(url);\n    } catch (err) {\n      var _err$response4, _err$response4$data;\n      setFinalizeError(((_err$response4 = err.response) === null || _err$response4 === void 0 ? void 0 : (_err$response4$data = _err$response4.data) === null || _err$response4$data === void 0 ? void 0 : _err$response4$data.message) || 'Failed to finalize and download PDF.');\n    } finally {\n      setFinalizeLoading(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex flex-col h-screen min-h-0 w-full\",\n    children: [/*#__PURE__*/_jsxDEV(Header, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"h-12 flex items-center justify-center bg-gray-50 border-b border-gray-200 z-10\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"px-3 py-2 bg-gray-200 rounded disabled:opacity-50 font-semibold min-w-[44px] min-h-[36px] focus:outline-none focus:ring-2 focus:ring-indigo-400 mx-1\",\n        onClick: () => setCurrentPage(p => Math.max(1, p - 1)),\n        disabled: currentPage <= 1,\n        \"aria-label\": \"Previous page\",\n        title: \"Previous page\",\n        tabIndex: 0,\n        children: \"Previous\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 206,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"text-gray-700 font-medium mx-2\",\n        \"aria-live\": \"polite\",\n        children: [\"Page \", currentPage]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 216,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"px-3 py-2 bg-gray-200 rounded disabled:opacity-50 font-semibold min-w-[44px] min-h-[36px] focus:outline-none focus:ring-2 focus:ring-indigo-400 mx-1\",\n        onClick: () => setCurrentPage(p => p + 1),\n        disabled: false // We'll disable if we know numPages\n        ,\n        \"aria-label\": \"Next page\",\n        title: \"Next page\",\n        tabIndex: 0,\n        children: \"Next\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex-1 min-h-0 overflow-auto flex justify-center items-start bg-gray-50\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-full max-w-5xl flex flex-col items-center relative m-auto\",\n        children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n          className: \"text-2xl font-bold mb-4\",\n          children: \"Document Viewer\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 233,\n          columnNumber: 11\n        }, this), loading && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-gray-500\",\n          children: \"Loading document...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 234,\n          columnNumber: 23\n        }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-red-500\",\n          children: error\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 235,\n          columnNumber: 21\n        }, this), sigActionError && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-red-500\",\n          children: sigActionError\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 236,\n          columnNumber: 30\n        }, this), finalizeError && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-red-500\",\n          children: finalizeError\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 237,\n          columnNumber: 29\n        }, this), pdfBlobUrl && !loading && !error && /*#__PURE__*/_jsxDEV(PDFRenderer, {\n          file: pdfBlobUrl,\n          pageNumber: currentPage,\n          signatureFields: signatureFields,\n          onPageClick: pendingSignature ? handlePageClick : undefined,\n          onUpdateField: handleUpdateField,\n          onRemoveField: handleRemoveField,\n          onFieldSelect: handleFieldSelect,\n          selectedFieldId: selectedFieldId,\n          onPageChange: setCurrentPage,\n          initialPage: currentPage,\n          pageDims: pageDims\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 239,\n          columnNumber: 13\n        }, this), !pdfBlobUrl && !loading && !error && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-gray-500\",\n          children: \"No PDF loaded\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 254,\n          columnNumber: 13\n        }, this), docInfo && docInfo.status !== 'completed' && /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"mt-6 px-6 py-3 bg-green-600 text-white rounded-xl font-semibold shadow hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-400 disabled:opacity-50\",\n          onClick: handleFinalizeDownload,\n          disabled: finalizeLoading,\n          \"aria-label\": \"Finalize and download signed PDF\",\n          children: finalizeLoading ? 'Finalizing...' : 'Finalize & Download Signed PDF'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 258,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"fixed bottom-8 right-8 z-40 bg-indigo-600 text-white rounded-full shadow-lg p-4 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-400\",\n          onClick: () => setShowSignatureModal(true),\n          \"aria-label\": \"Add Signature\",\n          disabled: sigActionLoading,\n          children: /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-2xl font-bold\",\n            children: \"+\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 274,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 268,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(SignatureInputModal, {\n          open: showSignatureModal,\n          onClose: () => {\n            setShowSignatureModal(false);\n            setPendingSignature(null);\n          },\n          onSave: handleSignatureSave\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 277,\n          columnNumber: 11\n        }, this), selectedField && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"fixed bottom-8 left-8 bg-white rounded shadow-lg px-4 py-2 text-gray-700 z-40\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"font-semibold\",\n            children: \"Signature Coordinates\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 285,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [\"Page: \", selectedField.page]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 286,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [\"X: \", Math.round(selectedField.x)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 287,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [\"Y: \", Math.round(selectedField.y)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 288,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [\"Width: \", Math.round(selectedField.width)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 289,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [\"Height: \", Math.round(selectedField.height)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 290,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 284,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 232,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 231,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 202,\n    columnNumber: 5\n  }, this);\n};\n_s(DocumentViewerPage, \"Fn3SM/gU5JSj9Zilntfwd18NRhU=\", false, function () {\n  return [useParams, useAuth];\n});\n_c = DocumentViewerPage;\nexport default DocumentViewerPage;\nvar _c;\n$RefreshReg$(_c, \"DocumentViewerPage\");","map":{"version":3,"names":["React","useState","useEffect","useParams","useAuth","api","PDFRenderer","Header","SignatureInputModal","cssToPDF","jsxDEV","_jsxDEV","DEFAULT_SIG_WIDTH","DEFAULT_SIG_HEIGHT","DocumentViewerPage","_s","id","token","user","pdfFile","setPdfFile","docInfo","setDocInfo","loading","setLoading","error","setError","signatureFields","setSignatureFields","showSignatureModal","setShowSignatureModal","pendingSignature","setPendingSignature","selectedFieldId","setSelectedFieldId","pageDims","setPageDims","width","height","currentPage","setCurrentPage","sigActionLoading","setSigActionLoading","sigActionError","setSigActionError","finalizeLoading","setFinalizeLoading","finalizeError","setFinalizeError","pdfBlobUrl","setPdfBlobUrl","fetchDoc","docRes","get","data","document","signers","overlays","filter","s","signatureData","image","map","idx","_id","page","x","y","rotation","signature","type","signerEmail","email","err","_err$response","_err$response$data","response","message","fetchPdfBlob","res","responseType","headers","Authorization","blobUrl","window","URL","createObjectURL","_err$response2","_err$response2$data","revokeObjectURL","handlePageClick","dims","pdfCoords","post","documentId","signerName","firstName","lastName","signatureType","position","_err$response3","_err$response3$data","handleUpdateField","updates","fields","f","handleRemoveField","handleSignatureSave","dataUrl","handleFieldSelect","selectedField","find","handleFinalizeDownload","url","Blob","link","createElement","href","setAttribute","originalName","body","appendChild","click","parentNode","removeChild","_err$response4","_err$response4$data","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","p","Math","max","disabled","title","tabIndex","file","pageNumber","onPageClick","undefined","onUpdateField","onRemoveField","onFieldSelect","onPageChange","initialPage","status","open","onClose","onSave","round","_c","$RefreshReg$"],"sources":["D:/Doc Sign/client/src/pages/DocumentViewerPage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useParams } from 'react-router-dom';\r\nimport { useAuth, api } from '../context/AuthContext';\r\nimport PDFRenderer from '../components/PDFRenderer';\r\nimport Header from '../components/Header';\r\nimport SignatureInputModal from '../components/SignatureInputModal';\r\nimport { cssToPDF } from '../utils/coordinateTransform';\r\n\r\nconst DEFAULT_SIG_WIDTH = 180;\r\nconst DEFAULT_SIG_HEIGHT = 60;\r\n\r\n// TODO: Integrate signature overlay and placement logic\r\n\r\nconst DocumentViewerPage = () => {\r\n  const { id } = useParams();\r\n  const { token, user } = useAuth();\r\n  const [pdfFile, setPdfFile] = useState(null); // Blob or URL\r\n  const [docInfo, setDocInfo] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [signatureFields, setSignatureFields] = useState([]);\r\n  const [showSignatureModal, setShowSignatureModal] = useState(false);\r\n  const [pendingSignature, setPendingSignature] = useState(null); // { dataUrl, type }\r\n  const [selectedFieldId, setSelectedFieldId] = useState(null);\r\n  const [pageDims, setPageDims] = useState({ width: 900, height: 1200 });\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [sigActionLoading, setSigActionLoading] = useState(false);\r\n  const [sigActionError, setSigActionError] = useState('');\r\n  const [finalizeLoading, setFinalizeLoading] = useState(false);\r\n  const [finalizeError, setFinalizeError] = useState('');\r\n  const [pdfBlobUrl, setPdfBlobUrl] = useState(null);\r\n\r\n  // Fetch document metadata and signature overlays only.\r\n  useEffect(() => {\r\n    if (!id) return;\r\n    setLoading(true);\r\n    setError('');\r\n    setDocInfo(null);\r\n    setSignatureFields([]);\r\n    const fetchDoc = async () => {\r\n      try {\r\n        // Fetch document metadata\r\n        const docRes = await api.get(`/api/docs/${id}`);\r\n        setDocInfo(docRes.data.document);\r\n        // Map signers/signatureData to overlays\r\n        const signers = docRes.data.document.signers || [];\r\n        const overlays = signers\r\n          .filter(s => s.signatureData && s.signatureData.image)\r\n          .map((s, idx) => ({\r\n            id: s._id || idx,\r\n            page: s.signatureData.page || 1,\r\n            x: s.signatureData.x || 50,\r\n            y: s.signatureData.y || 50,\r\n            width: s.signatureData.width || DEFAULT_SIG_WIDTH,\r\n            height: s.signatureData.height || DEFAULT_SIG_HEIGHT,\r\n            rotation: s.signatureData.rotation || 0,\r\n            signature: { data: s.signatureData.image, type: s.signatureData.type },\r\n            signerEmail: s.email,\r\n          }));\r\n        setSignatureFields(overlays);\r\n      } catch (err) {\r\n        setError(err.response?.data?.message || 'Failed to load document.');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchDoc();\r\n  }, [id, token]);\r\n\r\n  useEffect(() => {\r\n    const fetchPdfBlob = async () => {\r\n      if (!docInfo) return;\r\n      try {\r\n        setLoading(true);\r\n        setError('');\r\n        const res = await api.get(`/api/docs/${docInfo._id}/download`, {\r\n          responseType: 'blob',\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        });\r\n        const blobUrl = window.URL.createObjectURL(res.data);\r\n        setPdfBlobUrl(blobUrl);\r\n      } catch (err) {\r\n        setError(err.response?.data?.message || 'Failed to load PDF.');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchPdfBlob();\r\n    // Clean up blob URL on unmount\r\n    return () => {\r\n      if (pdfBlobUrl) window.URL.revokeObjectURL(pdfBlobUrl);\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [docInfo, token]);\r\n\r\n  // Handle click-to-place signature field (only if a signature is pending)\r\n  const handlePageClick = async (page, x, y, dims) => {\r\n    if (!pendingSignature || !docInfo) return;\r\n    setSigActionLoading(true);\r\n    setSigActionError('');\r\n    try {\r\n      // Convert to PDF coordinates\r\n      const pdfCoords = cssToPDF(x, y, dims.height, 1); // scale=1 for now\r\n      // Save to backend (self-sign)\r\n      await api.post('/api/signatures/self-sign', {\r\n        documentId: docInfo._id,\r\n        signerEmail: user.email,\r\n        signerName: user.firstName + ' ' + user.lastName,\r\n        signatureData: pendingSignature.data,\r\n        signatureType: pendingSignature.type,\r\n        position: {\r\n          page,\r\n          x: pdfCoords.x,\r\n          y: pdfCoords.y,\r\n          width: DEFAULT_SIG_WIDTH,\r\n          height: DEFAULT_SIG_HEIGHT,\r\n          rotation: 0,\r\n          image: pendingSignature.data,\r\n          type: pendingSignature.type,\r\n        },\r\n      });\r\n      // Reload document and overlays\r\n      const docRes = await api.get(`/api/docs/${id}`);\r\n      setDocInfo(docRes.data.document);\r\n      const signers = docRes.data.document.signers || [];\r\n      const overlays = signers\r\n        .filter(s => s.signatureData && s.signatureData.image)\r\n        .map((s, idx) => ({\r\n          id: s._id || idx,\r\n          page: s.signatureData.page || 1,\r\n          x: s.signatureData.x || 50,\r\n          y: s.signatureData.y || 50,\r\n          width: s.signatureData.width || DEFAULT_SIG_WIDTH,\r\n          height: s.signatureData.height || DEFAULT_SIG_HEIGHT,\r\n          rotation: s.signatureData.rotation || 0,\r\n          signature: { data: s.signatureData.image, type: s.signatureData.type },\r\n          signerEmail: s.email,\r\n        }));\r\n      setSignatureFields(overlays);\r\n      setPendingSignature(null);\r\n      setShowSignatureModal(false);\r\n    } catch (err) {\r\n      setSigActionError(err.response?.data?.message || 'Failed to save signature.');\r\n    } finally {\r\n      setSigActionLoading(false);\r\n    }\r\n  };\r\n\r\n  // Update a signature field's position/size/rotation (optional: sync with backend)\r\n  const handleUpdateField = (id, updates) => {\r\n    setSignatureFields(fields => fields.map(f => f.id === id ? { ...f, ...updates } : f));\r\n    // Optionally, sync with backend here\r\n  };\r\n\r\n  // Remove a signature field (optional: sync with backend)\r\n  const handleRemoveField = (id) => {\r\n    setSignatureFields(fields => fields.filter(f => f.id !== id));\r\n    setSelectedFieldId(null);\r\n    // Optionally, sync with backend here\r\n  };\r\n\r\n  // Save signature modal result\r\n  const handleSignatureSave = (dataUrl, type) => {\r\n    setPendingSignature({ data: dataUrl, type });\r\n    // Modal closes, user will click to place on PDF\r\n  };\r\n\r\n  // Track selected field for coordinate display\r\n  const handleFieldSelect = (id) => {\r\n    setSelectedFieldId(id);\r\n  };\r\n\r\n  // Get selected field's coordinates (PDF system)\r\n  const selectedField = signatureFields.find(f => f.id === selectedFieldId);\r\n\r\n  // Finalize and download signed PDF\r\n  const handleFinalizeDownload = async () => {\r\n    if (!docInfo) return;\r\n    setFinalizeLoading(true);\r\n    setFinalizeError('');\r\n    try {\r\n      const res = await api.post(`/api/signatures/finalize/${docInfo._id}`, {}, {\r\n        responseType: 'blob',\r\n      });\r\n      // Download the PDF\r\n      const url = window.URL.createObjectURL(new Blob([res.data], { type: 'application/pdf' }));\r\n      const link = document.createElement('a');\r\n      link.href = url;\r\n      link.setAttribute('download', `${docInfo.originalName || 'signed-document'}.pdf`);\r\n      document.body.appendChild(link);\r\n      link.click();\r\n      link.parentNode.removeChild(link);\r\n      window.URL.revokeObjectURL(url);\r\n    } catch (err) {\r\n      setFinalizeError(err.response?.data?.message || 'Failed to finalize and download PDF.');\r\n    } finally {\r\n      setFinalizeLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-screen min-h-0 w-full\">\r\n      <Header />\r\n      {/* Navigation Toolbar restored */}\r\n      <div className=\"h-12 flex items-center justify-center bg-gray-50 border-b border-gray-200 z-10\">\r\n        <button\r\n          className=\"px-3 py-2 bg-gray-200 rounded disabled:opacity-50 font-semibold min-w-[44px] min-h-[36px] focus:outline-none focus:ring-2 focus:ring-indigo-400 mx-1\"\r\n          onClick={() => setCurrentPage((p) => Math.max(1, p - 1))}\r\n          disabled={currentPage <= 1}\r\n          aria-label=\"Previous page\"\r\n          title=\"Previous page\"\r\n          tabIndex={0}\r\n        >\r\n          Previous\r\n        </button>\r\n        <span className=\"text-gray-700 font-medium mx-2\" aria-live=\"polite\">\r\n          Page {currentPage}\r\n        </span>\r\n        <button\r\n          className=\"px-3 py-2 bg-gray-200 rounded disabled:opacity-50 font-semibold min-w-[44px] min-h-[36px] focus:outline-none focus:ring-2 focus:ring-indigo-400 mx-1\"\r\n          onClick={() => setCurrentPage((p) => p + 1)}\r\n          disabled={false} // We'll disable if we know numPages\r\n          aria-label=\"Next page\"\r\n          title=\"Next page\"\r\n          tabIndex={0}\r\n        >\r\n          Next\r\n        </button>\r\n      </div>\r\n      {/* PDF Viewer Container - bulletproof flex layout */}\r\n      <div className=\"flex-1 min-h-0 overflow-auto flex justify-center items-start bg-gray-50\">\r\n        <div className=\"w-full max-w-5xl flex flex-col items-center relative m-auto\">\r\n          <h1 className=\"text-2xl font-bold mb-4\">Document Viewer</h1>\r\n          {loading && <div className=\"text-gray-500\">Loading document...</div>}\r\n          {error && <div className=\"text-red-500\">{error}</div>}\r\n          {sigActionError && <div className=\"text-red-500\">{sigActionError}</div>}\r\n          {finalizeError && <div className=\"text-red-500\">{finalizeError}</div>}\r\n          {pdfBlobUrl && !loading && !error && (\r\n            <PDFRenderer\r\n              file={pdfBlobUrl}\r\n              pageNumber={currentPage}\r\n              signatureFields={signatureFields}\r\n              onPageClick={pendingSignature ? handlePageClick : undefined}\r\n              onUpdateField={handleUpdateField}\r\n              onRemoveField={handleRemoveField}\r\n              onFieldSelect={handleFieldSelect}\r\n              selectedFieldId={selectedFieldId}\r\n              onPageChange={setCurrentPage}\r\n              initialPage={currentPage}\r\n              pageDims={pageDims}\r\n            />\r\n          )}\r\n          {!pdfBlobUrl && !loading && !error && (\r\n            <div className=\"text-gray-500\">No PDF loaded</div>\r\n          )}\r\n          {/* Finalize & Download Button */}\r\n          {docInfo && docInfo.status !== 'completed' && (\r\n            <button\r\n              className=\"mt-6 px-6 py-3 bg-green-600 text-white rounded-xl font-semibold shadow hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-400 disabled:opacity-50\"\r\n              onClick={handleFinalizeDownload}\r\n              disabled={finalizeLoading}\r\n              aria-label=\"Finalize and download signed PDF\"\r\n            >\r\n              {finalizeLoading ? 'Finalizing...' : 'Finalize & Download Signed PDF'}\r\n            </button>\r\n          )}\r\n          {/* Floating Add Signature Button */}\r\n          <button\r\n            className=\"fixed bottom-8 right-8 z-40 bg-indigo-600 text-white rounded-full shadow-lg p-4 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-400\"\r\n            onClick={() => setShowSignatureModal(true)}\r\n            aria-label=\"Add Signature\"\r\n            disabled={sigActionLoading}\r\n          >\r\n            <span className=\"text-2xl font-bold\">+</span>\r\n          </button>\r\n          {/* Signature Creation Modal */}\r\n          <SignatureInputModal\r\n            open={showSignatureModal}\r\n            onClose={() => { setShowSignatureModal(false); setPendingSignature(null); }}\r\n            onSave={handleSignatureSave}\r\n          />\r\n          {/* Real-time coordinate display for selected field */}\r\n          {selectedField && (\r\n            <div className=\"fixed bottom-8 left-8 bg-white rounded shadow-lg px-4 py-2 text-gray-700 z-40\">\r\n              <div className=\"font-semibold\">Signature Coordinates</div>\r\n              <div>Page: {selectedField.page}</div>\r\n              <div>X: {Math.round(selectedField.x)}</div>\r\n              <div>Y: {Math.round(selectedField.y)}</div>\r\n              <div>Width: {Math.round(selectedField.width)}</div>\r\n              <div>Height: {Math.round(selectedField.height)}</div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default DocumentViewerPage; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}